<!DOCTYPE html>
<html lang="en">
  {% load static %}
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link rel="icon" type="image/png" href="{% static 'media/MA.png' %}?v=2" />
    <link rel="shortcut icon" href="{% static 'media/MA.png' %}?v=2" />
    <link rel="stylesheet" href="{% static 'css/login.css' %}?v=14" />
    <!-- <link rel="stylesheet" href="{% static 'css/toast.css' %}">  -->
  </head>

  <body>
    <div class="auth-container">
      <div class="background-decoration">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
        
        <!-- Agricultural Icons -->
        <div class="agri-icon rice-icon">
          <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
            <!-- Professional rice plant bundle -->
            <defs>
              <linearGradient id="riceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#11998e;stop-opacity:0.9" />
                <stop offset="100%" style="stop-color:#11998e;stop-opacity:0.6" />
              </linearGradient>
            </defs>
            <!-- Main stems -->
            <path d="M50 95 Q48 70, 45 45 Q44 30, 42 20" stroke="url(#riceGrad)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <path d="M60 95 Q60 70, 60 45 Q60 30, 60 18" stroke="url(#riceGrad)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <path d="M70 95 Q72 70, 75 45 Q76 30, 78 20" stroke="url(#riceGrad)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <!-- Rice grains with glow effect -->
            <g filter="url(#glow)">
              <ellipse cx="38" cy="25" rx="4" ry="7" fill="#11998e" opacity="0.8"/>
              <ellipse cx="42" cy="18" rx="4" ry="7" fill="#11998e" opacity="0.85"/>
              <ellipse cx="46" cy="22" rx="4" ry="7" fill="#11998e" opacity="0.8"/>
              <ellipse cx="56" cy="20" rx="4" ry="7" fill="#11998e" opacity="0.85"/>
              <ellipse cx="60" cy="14" rx="4" ry="7" fill="#11998e" opacity="0.9"/>
              <ellipse cx="64" cy="20" rx="4" ry="7" fill="#11998e" opacity="0.85"/>
              <ellipse cx="74" cy="25" rx="4" ry="7" fill="#11998e" opacity="0.8"/>
              <ellipse cx="78" cy="18" rx="4" ry="7" fill="#11998e" opacity="0.85"/>
              <ellipse cx="82" cy="22" rx="4" ry="7" fill="#11998e" opacity="0.8"/>
            </g>
            <!-- Leaves -->
            <path d="M42 40 Q35 38, 30 40" stroke="#11998e" stroke-width="1.5" fill="none" opacity="0.6"/>
            <path d="M60 35 Q55 32, 52 30" stroke="#11998e" stroke-width="1.5" fill="none" opacity="0.6"/>
            <path d="M78 40 Q85 38, 90 40" stroke="#11998e" stroke-width="1.5" fill="none" opacity="0.6"/>
          </svg>
        </div>
        
        <div class="agri-icon pesticide-icon">
          <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
            <!-- Modern spray canister -->
            <defs>
              <linearGradient id="canisterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#11998e;stop-opacity:0.85" />
                <stop offset="100%" style="stop-color:#11998e;stop-opacity:0.65" />
              </linearGradient>
            </defs>
            <!-- Canister body -->
            <rect x="45" y="55" width="30" height="45" rx="4" fill="url(#canisterGrad)"/>
            <rect x="47" y="57" width="26" height="3" rx="1" fill="#ffffff" opacity="0.3"/>
            <!-- Handle/trigger -->
            <rect x="50" y="40" width="20" height="18" rx="3" fill="#11998e" opacity="0.8"/>
            <path d="M55 40 L55 30 L65 30 L65 40" stroke="#11998e" stroke-width="3" fill="none" opacity="0.7" stroke-linecap="round"/>
            <circle cx="60" cy="27" r="4" fill="#11998e" opacity="0.75"/>
            <!-- Professional spray pattern -->
            <g opacity="0.5">
              <path d="M35 48 Q32 45, 28 43" stroke="#11998e" stroke-width="2" fill="none" stroke-linecap="round"/>
              <path d="M30 52 Q25 50, 20 48" stroke="#11998e" stroke-width="2" fill="none" stroke-linecap="round"/>
              <path d="M32 56 Q28 55, 24 54" stroke="#11998e" stroke-width="2" fill="none" stroke-linecap="round"/>
              <circle cx="25" cy="42" r="2" fill="#11998e" opacity="0.6"/>
              <circle cx="18" cy="47" r="2" fill="#11998e" opacity="0.5"/>
              <circle cx="22" cy="53" r="2" fill="#11998e" opacity="0.6"/>
              <circle cx="28" cy="48" r="1.5" fill="#11998e" opacity="0.4"/>
            </g>
          </svg>
        </div>
        
        <div class="agri-icon paddy-field-icon">
          <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
            <!-- Terraced paddy field -->
            <defs>
              <linearGradient id="fieldGrad1" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#11998e;stop-opacity:0.4" />
                <stop offset="100%" style="stop-color:#11998e;stop-opacity:0.25" />
              </linearGradient>
            </defs>
            <!-- Terraced fields -->
            <path d="M15 85 L105 85 L105 95 L15 95 Z" fill="url(#fieldGrad1)"/>
            <path d="M20 70 L100 70 L100 82 L20 82 Z" fill="#11998e" opacity="0.35"/>
            <path d="M25 58 L95 58 L95 68 L25 68 Z" fill="#11998e" opacity="0.3"/>
            <!-- Rice plants with varying heights -->
            <g opacity="0.7">
              <line x1="30" y1="70" x2="30" y2="52" stroke="#11998e" stroke-width="2"/>
              <ellipse cx="28" cy="50" rx="3" ry="5" fill="#11998e"/>
              <ellipse cx="32" cy="50" rx="3" ry="5" fill="#11998e"/>
              
              <line x1="45" y1="70" x2="45" y2="48" stroke="#11998e" stroke-width="2"/>
              <ellipse cx="43" cy="46" rx="3" ry="5" fill="#11998e"/>
              <ellipse cx="47" cy="46" rx="3" ry="5" fill="#11998e"/>
              
              <line x1="60" y1="70" x2="60" y2="50" stroke="#11998e" stroke-width="2"/>
              <ellipse cx="58" cy="48" rx="3" ry="5" fill="#11998e"/>
              <ellipse cx="62" cy="48" rx="3" ry="5" fill="#11998e"/>
              
              <line x1="75" y1="70" x2="75" y2="53" stroke="#11998e" stroke-width="2"/>
              <ellipse cx="73" cy="51" rx="3" ry="5" fill="#11998e"/>
              <ellipse cx="77" cy="51" rx="3" ry="5" fill="#11998e"/>
              
              <line x1="88" y1="70" x2="88" y2="49" stroke="#11998e" stroke-width="2"/>
              <ellipse cx="86" cy="47" rx="3" ry="5" fill="#11998e"/>
              <ellipse cx="90" cy="47" rx="3" ry="5" fill="#11998e"/>
            </g>
            <!-- Water ripples -->
            <ellipse cx="40" cy="78" rx="8" ry="2" fill="#11998e" opacity="0.2"/>
            <ellipse cx="70" cy="77" rx="10" ry="2" fill="#11998e" opacity="0.2"/>
          </svg>
        </div>
        
        <div class="leaf-accent leaf-1"></div>
        <div class="leaf-accent leaf-2"></div>
      </div>
      
      <div class="auth-center">
        <div class="logo-container">
          <img
            src="{% static 'media/FULL.png' %}"
            alt="Logo"
            class="logo-above-login"
            style="max-width: 280px; height: auto; margin-bottom: 30px;"
          />
        </div>
       
        <div class="login-section">
          <div class="decorative-corner corner-top-left"></div>
          <div class="decorative-corner corner-top-right"></div>
          <h1>
            <span class="highlight">Hey !</span> <br />
            Welcome Back
          </h1>
          <p class="subtitle">Enter your credentials to access your account</p>

          <!-- Main tabs -->
          <div class="tab-container">
            <div class="tab-nav">
              <button class="login tab-btn active" data-tab="signin">
                Sign In
              </button>
              <button class="login tab-btn" data-tab="signup">Sign Up</button>
            </div>

            <!-- Sign In Tab -->
            <div class="tab-content active" id="signin">
              <form method="POST" action="{% url 'login_app:login' %}">
                {% csrf_token %}
                <!-- Security Token -->

                <label class="text" for="username">USER ID</label>
                <input type="text" name="username" id="username" placeholder="Enter your phone number" required />

                <label class="text" for="password">PASSWORD</label>
                <div class="password-field-wrapper">
                  <input type="password" name="password" id="password" placeholder="Enter your password" required />
                  <button type="button" class="password-toggle" id="signin-password-toggle" onclick="togglePasswordVisibility('password', 'signin-password-toggle')">
                    <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                </div>

                <button class="login" type="submit">LOG IN</button>
              </form>
            </div>
            <!-- Sign Up Tab -->
            <div class="tab-content" id="signup">
              <!-- Role Selector -->
              <label class="text" for="signup-role">SELECT ROLE</label>
              <select id="signup-role">
                <option value="customer">Customer</option>
                <option value="admin">Admin</option>
              </select>

              <!-- Admin Signup Form -->
              <div id="admin-form" class="form-card" style="display: none">
                <form
                  method="POST"
                  action="{% url 'onboarding:create_admin_signup' %}"
                >
                  {% csrf_token %}
                  <div class="form-row">
                    <div class="form-group" style="margin-top: 10px">
                      <label>First Name</label>
                      <input
                        type="text"
                        name="first_name"
                        placeholder="Enter your first name"
                        required
                        pattern="[A-Za-z\s]+"
                        minlength="2"
                      />
                    </div>
                    <div class="form-group" style="margin-top: 10px">
                      <label>Last Name</label>
                      <input
                        type="text"
                        name="last_name"
                        placeholder="Enter your last name"
                        required
                        pattern="[A-Za-z\s]+"
                        minlength="1"
                      />
                    </div>
                  </div>

                  <label>Phone Number</label>
                  <input
                    type="tel"
                    name="phone_number"
                    placeholder="Enter phone number"
                    required
                    pattern="[0-9]{10}"
                    maxlength="10"
                  />

                  <label>Email</label>
                  <input type="email" name="email" placeholder="Enter your email" required />

                  <label>Password</label>
                  <div class="password-field-wrapper">
                    <input
                      type="password"
                      name="password"
                      placeholder="Enter password"
                      class="admin-password"
                      required
                      minlength="6"
                    />
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                      <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                    </button>
                  </div>

                  <label>Confirm Password</label>
                  <div class="password-field-wrapper">
                    <input
                      type="password"
                      name="confirm_password"
                      placeholder="Confirm password"
                      class="admin-confirm-password"
                      required
                      minlength="6"
                    />
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                      <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                    </button>
                  </div>

                  <input type="hidden" name="role" value="0" />
                  <button type="submit">Create Admin User</button>
                </form>
              </div>

              <!-- Customer Signup Form -->
              <div id="customer-form" class="form-card" style="display: none">
                <form
                  method="POST"
                  action="{% url 'onboarding:create_customer_signup' %}"
                >
                  {% csrf_token %}
                  <!-- First Row: Name Fields -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="first_name">First Name</label>
                      <input
                        type="text"
                        id="first_name"
                        name="first_name"
                        placeholder="Enter your first name"
                        required
                        pattern="[A-Za-z]+"
                        minlength="2"
                      />
                    </div>
                    <div class="form-group">
                      <label for="last_name">Last Name</label>
                      <input
                        type="text"
                        id="last_name"
                        name="last_name"
                        placeholder="Enter your last name"
                        required
                        pattern="[A-Za-z]+"
                        minlength="1"
                      />
                    </div>
                  </div>

                  <!-- Second Row: Contact Fields -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="phone_number">Phone Number</label>
                      <input
                        type="tel"
                        id="phone_number"
                        name="phone_number"
                        placeholder="Enter phone number"
                        required
                        pattern="[0-9]{10}"
                        maxlength="10"
                      />
                    </div>
                    <div class="form-group">
                      <label for="email">Email</label>
                      <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Enter your email"
                        required
                      />
                    </div>
                  </div>

                  <!-- Third Row: Password Fields -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="password">Password</label>
                      <div class="password-field-wrapper">
                        <input
                          type="password"
                          id="password"
                          name="password"
                          placeholder="Enter password"
                          class="customer-password"
                          required
                          minlength="6"
                        />
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                          <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                          </svg>
                        </button>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="confirm_password">Confirm Password</label>
                      <div class="password-field-wrapper">
                        <input
                          type="password"
                          id="confirm_password"
                          name="confirm_password"
                          placeholder="Confirm password"
                          class="customer-confirm-password"
                          required
                          minlength="6"
                        />
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                          <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Fourth Row: Company Fields -->
                  <div class="form-row">
                    <div class="form-group">
                      <label for="company_name">Company Name</label>
                      <input
                        type="text"
                        id="company_name"
                        name="company_name"
                        placeholder="Enter company name"
                        required
                        minlength="2"
                      />
                    </div>
                    <div class="form-group">
                      <label for="gst">GST Number (Optional)</label>
                      <input
                        type="text"
                        id="gst"
                        name="gst"
                        placeholder="Enter GST number"
                        pattern="[0-9A-Z]{15}"
                      />
                    </div>
                  </div>

                  <!-- Full Width Address Field -->
                  <div class="form-row">
                    <div class="form-group full-width">
                      <label for="address">Address</label>
                      <textarea
                        id="address"
                        name="address"
                        placeholder="Enter your address"
                        rows="3"
                        required
                        minlength="5"
                      ></textarea>
                    </div>
                  </div>

                  <input type="hidden" name="role" value="1" />
                  <button type="submit">Create Customer Account</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification System - Moved outside to be positioned relative to viewport -->
    <div class="toast-container">
      {% if messages %} {% for message in messages %}
      <div
        class="toast {% if message.tags == 'success' %}success {% elif message.tags == 'info' %}info {% elif message.tags == 'warning' %}warning {% elif message.tags == 'error' %}error {% endif %}"
      >
        {{ message }}
        <button type="button" class="toast-close" aria-label="Close">
          &times;
        </button>
      </div>
      {% endfor %} {% endif %}
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Use event delegation for toast close buttons to handle dynamically added toasts
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("toast-close")) {
            const toast = e.target.closest(".toast");
            if (toast) {
              toast.style.animation = "fadeOutToast 0.3s forwards";
              setTimeout(() => {
                if (toast.parentElement) {
                  toast.remove();
                }
              }, 300);
            }
          }
        });

        // Auto-dismiss toasts after 5 seconds
        document.querySelectorAll(".toast").forEach((toast) => {
          setTimeout(() => {
            if (toast && toast.parentElement) {
              toast.style.animation = "fadeOutToast 0.3s forwards";
              setTimeout(() => {
                if (toast && toast.parentElement) {
                  toast.remove();
                }
              }, 300);
            }
          }, 5000);
        });

        // Global function to create test toasts (for debugging)
        window.createTestToast = function (message, type = "info") {
          const container = document.querySelector(".toast-container");
          if (container) {
            const toast = document.createElement("div");
            toast.className = `toast ${type}`;
            toast.innerHTML = `${message}<button type="button" class="toast-close" aria-label="Close">&times;</button>`;
            container.appendChild(toast);

            // Auto-dismiss after 5 seconds
            setTimeout(() => {
              if (toast && toast.parentElement) {
                toast.style.animation = "fadeOutToast 0.3s forwards";
                setTimeout(() => {
                  if (toast && toast.parentElement) {
                    toast.remove();
                  }
                }, 300);
              }
            }, 5000);
          }
        };
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Handle initial visibility based on default selected role
        const role = document.getElementById("signup-role").value;
        document.getElementById("admin-form").style.display =
          role === "admin" ? "block" : "none";
        document.getElementById("customer-form").style.display =
          role === "customer" ? "block" : "none";

        // Tab switching logic
        document.querySelectorAll(".tab-btn").forEach((button) => {
          button.addEventListener("click", () => {
            document
              .querySelectorAll(".tab-btn")
              .forEach((btn) => btn.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((tab) => tab.classList.remove("active"));
            button.classList.add("active");
            document.getElementById(button.dataset.tab).classList.add("active");
          });
        });

        // Role-based form toggle
        document
          .getElementById("signup-role")
          .addEventListener("change", function () {
            document.getElementById("admin-form").style.display =
              this.value === "admin" ? "block" : "none";
            document.getElementById("customer-form").style.display =
              this.value === "customer" ? "block" : "none";
          });
      });
    </script>

    <!-- Password visibility toggle script -->
    <script>
      function togglePasswordVisibility(element) {
        let input;
        
        // Handle both direct element and button in wrapper scenarios
        if (element === 'password' || typeof element === 'string') {
          // Direct element ID passed (signin form)
          input = document.getElementById(element);
        } else if (element.tagName === 'BUTTON') {
          // Button passed, find the input in the wrapper
          input = element.closest('.password-field-wrapper').querySelector('input');
        }
        
        if (input) {
          const isPassword = input.type === 'password';
          input.type = isPassword ? 'text' : 'password';
          
          // Update eye icon
          const icon = element.tagName === 'BUTTON' ? element : document.getElementById(element + '-toggle');
          if (icon) {
            const svg = icon.querySelector('svg');
            if (svg) {
              if (isPassword) {
                // Changing to text - show closed eye icon
                svg.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-5.07 5.93m-5.02-5.02a3 3 0 1 1 4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
              } else {
                // Changing back to password - show open eye icon
                svg.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
              }
            }
          }
        }
      }
    </script>

    <script src="{% static 'js/login.js' %}" defer></script>
  </body>
</html>
