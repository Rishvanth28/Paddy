{% extends 'customer_base.html' %}
{% load static %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #667eea;
        --primary-hover: #5a6fd8;
        --secondary: #764ba2;
        --success: #4caf50;
        --warning: #ff9800;
        --danger: #f44336;
        --info: #2196f3;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #666;
        --border: #ddd;
        --card-bg: rgba(42, 42, 42, 0.9);
        --card-hover: rgba(51, 51, 51, 0.9);
        --text-light: #e0e0e0;
        --text-muted: #9e9e9e;
        --text-muted-order: #000000;
        --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.3);
        --shadow-heavy: 0 20px 40px rgba(0, 0, 0, 0.4);
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-success: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        --gradient-warning: linear-gradient(135deg, #ff9800 0%, #e68900 100%);
        --gradient-danger: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --border-radius: 12px;
        --border-radius-sm: 8px;
        --blur-sm: blur(10px);
        --blur-md: blur(20px);
        --blur-lg: blur(40px);
    }

    * {
        box-sizing: border-box;
    }


    /* Container and Layout */
    .container-fluid {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem 1rem;
        background: transparent;
        position: relative;
    }

    .container-fluid::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(42, 42, 42, 0.1);
        border-radius: 20px;
        z-index: -1;
        backdrop-filter: blur(40px);
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        margin: -0.75rem;
    }

    .col-md-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
        padding: 0.75rem;
    }

    .col-md-8 {
        flex: 0 0 66.666667%;
        max-width: 66.666667%;
        padding: 0.75rem;
    }

    .col-md-2 {
        flex: 0 0 16.666667%;
        max-width: 16.666667%;
        padding: 0.75rem;
    }

    .col-md-5 {
        flex: 0 0 41.666667%;
        max-width: 41.666667%;
        padding: 0.75rem;
    }

    @media (max-width: 768px) {

        .col-md-4,
        .col-md-8,
        .col-md-2,
        .col-md-5 {
            flex: 0 0 100%;
            max-width: 100%;
        }

        .page-title {
            font-size: 1.8rem;
        }

        .container-fluid {
            padding: 1rem 0.5rem;
        }

        .filter-section {
            padding: 1.5rem;
        }

        .order-list-container {
            max-height: 50vh;
        }

        .dashboard-card:hover,
        .customer-card:hover {
            transform: translateY(-2px) scale(1.005);
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 1.5rem;
        }

        .btn {
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
        }

        .filter-section {
            padding: 1rem;
        }

        .detail-section {
            padding: 1rem;
        }
    }

    /* Cards */
    .dashboard-card,
    .customer-card {
        background: linear-gradient(145deg, var(--card-bg) 0%, rgba(42, 42, 42, 0.95) 100%);
        border-radius: var(--border-radius);
        border: 1px solid rgba(68, 68, 68, 0.8);
        box-shadow:
            var(--shadow-medium),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        overflow: hidden;
        color: var(--text-light);
        transition: var(--transition);
        backdrop-filter: blur(20px);
        position: relative;
    }

    .dashboard-card::before,
    .customer-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        opacity: 0;
        transition: var(--transition);
    }

    .dashboard-card:hover,
    .customer-card:hover {
        transform: translateY(-6px) scale(1.01);
        box-shadow:
            0 20px 40px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        border-color: rgba(102, 119, 234, 0.3);
    }

    .dashboard-card:hover::before,
    .customer-card:hover::before {
        opacity: 1;
    }

    .card-header {
        background: linear-gradient(135deg,
                rgba(42, 42, 42, 0.9) 0%,
                rgba(51, 51, 51, 0.9) 100%);
        border-bottom: 1px solid rgba(102, 119, 234, 0.2);
        padding: 1.5rem 2rem;
        position: relative;
        backdrop-filter: blur(10px);
    }

    .card-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(102, 119, 234, 0.5), transparent);
    }

    .card-header h5 {
        font-weight: 600;
        margin: 0;
        color: var(--text-light);
        font-size: 1.2rem;
        letter-spacing: 0.5px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Messages */
    .alert {
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        border-radius: 12px;
        border: 1px solid;
        position: relative;
        font-size: 1rem;
        line-height: 1.5;
        backdrop-filter: blur(20px);
        animation: slideInDown 0.5s ease-out;
    }

    @keyframes slideInDown {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .alert-success {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(56, 142, 60, 0.1) 100%);
        border-color: rgba(76, 175, 80, 0.3);
        color: #4caf50;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
    }

    .alert-warning {
        background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(245, 124, 0, 0.1) 100%);
        border-color: rgba(255, 152, 0, 0.3);
        color: #ff9800;
        box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
    }

    .alert-danger,
    .alert-error {
        background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(211, 47, 47, 0.1) 100%);
        border-color: rgba(244, 67, 54, 0.3);
        color: #f44336;
        box-shadow: 0 4px 12px rgba(244, 67, 54, 0.2);
    }

    .alert-info {
        background: linear-gradient(135deg, rgba(102, 119, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border-color: rgba(102, 119, 234, 0.3);
        color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 119, 234, 0.2);
    }

    .btn-close {
        position: absolute;
        top: 0.5rem;
        right: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: inherit;
        opacity: 0.7;
    }

    .btn-close:hover {
        opacity: 1;
    }

    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        font-size: 0.95rem;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        border: 1px solid transparent;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        transition: var(--transition);
        margin: 0.25rem;
        position: relative;
        overflow: hidden;
        letter-spacing: 0.3px;
        text-transform: uppercase;
        font-size: 0.85rem;
    }

    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s;
    }

    .btn:hover::before {
        left: 100%;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: rgba(102, 119, 234, 0.3);
        box-shadow: 0 4px 15px rgba(102, 119, 234, 0.4);
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        border-color: rgba(102, 119, 234, 0.6);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 119, 234, 0.5);
    }

    .btn-outline-primary {
        background: rgba(102, 119, 234, 0.1);
        color: #667eea;
        border-color: rgba(102, 119, 234, 0.3);
        backdrop-filter: blur(10px);
    }

    .btn-outline-primary:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(102, 119, 234, 0.4);
    }

    .btn-success {
        background: var(--gradient-success);
        color: white;
        border-color: var(--success);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #45a049, #3d8b40);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .btn-outline-success {
        background: transparent;
        color: var(--success);
        border-color: var(--success);
        backdrop-filter: blur(10px);
    }

    .btn-outline-success:hover {
        background: var(--gradient-success);
        color: white;
        transform: translateY(-1px);
    }

    .btn-warning {
        background: var(--gradient-warning);
        color: white;
        border-color: var(--warning);
        box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }

    .btn-outline-warning {
        background: transparent;
        color: var(--warning);
        border-color: var(--warning);
        backdrop-filter: blur(10px);
    }

    .btn-outline-warning:hover {
        background: var(--gradient-warning);
        color: white;
        transform: translateY(-1px);
    }

    .btn-danger {
        background: var(--gradient-danger);
        color: white;
        border-color: var(--danger);
        box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }

    .btn-outline-danger {
        background: transparent;
        color: var(--danger);
        border-color: var(--danger);
        backdrop-filter: blur(10px);
    }

    .btn-outline-danger:hover {
        background: var(--gradient-danger);
        color: white;
        transform: translateY(-1px);
    }

    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        border-radius: 6px;
    }

    .btn:active {
        transform: translateY(0) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
    }

    .w-100 {
        width: 100%;
    }

    /* Forms */
    .form-control,
    .form-select {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: var(--text-light);
        background: linear-gradient(145deg, rgba(42, 42, 42, 0.9) 0%, rgba(51, 51, 51, 0.9) 100%);
        border: 2px solid rgba(68, 68, 68, 0.5);
        border-radius: var(--border-radius-sm);
        transition: var(--transition);
        box-sizing: border-box;
        backdrop-filter: blur(15px);
        cursor: pointer;
        /* Added cursor pointer */
    }

    .form-control:focus,
    .form-select:focus {
        border-color: rgba(102, 119, 234, 0.6);
        outline: 0;
        box-shadow: 0 0 0 3px rgba(102, 119, 234, 0.15);
        background: linear-gradient(145deg, rgba(51, 51, 51, 0.9) 0%, rgba(42, 42, 42, 0.9) 100%);
        transform: translateY(-1px);
        cursor: pointer;
        /* Maintain cursor pointer on focus */
    }

    .form-control:hover,
    .form-select:hover {
        border-color: rgba(102, 119, 234, 0.4);
        background: linear-gradient(145deg, rgba(51, 51, 51, 0.9) 0%, rgba(42, 42, 42, 0.9) 100%);
        cursor: pointer;
        /* Maintain cursor pointer on hover */
    }

    .form-control-sm,
    .form-select-sm {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        border-radius: 6px;
        cursor: pointer;
        /* Added cursor pointer for small form elements */
    }

    /* Specific styles for date inputs */
    input[type="date"] {
        cursor: pointer !important;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.2s ease;
    }

    input[type="date"]::-webkit-calendar-picker-indicator:hover {
        opacity: 1;
    }

    /* Select dropdown arrow styling */
    .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23e0e0e0' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 16px 12px;
        cursor: pointer !important;
    }

    /* List Groups */
    .list-group {
        display: flex;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
    }

    .list-group-item {
        position: relative;
        display: block;
        padding: 1.25rem 1.5rem;
        color: var(--text-light);
        background-color: rgba(42, 42, 42, 0.6);
        border: 1px solid rgba(68, 68, 68, 0.3);
        border-top-width: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        backdrop-filter: blur(10px);
    }

    .list-group-item:first-child {
        border-top-width: 1px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    .list-group-item:last-child {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }

    .list-group-item:hover {
        background-color: rgba(51, 51, 51, 0.8);
        transform: translateX(4px);
        border-color: rgba(102, 119, 234, 0.3);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .list-group-item.active {
        background: linear-gradient(135deg, rgba(102, 119, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
        border-color: rgba(102, 119, 234, 0.5);
        color: var(--text-light);
        transform: translateX(6px);
        box-shadow: 0 6px 20px rgba(102, 119, 234, 0.2);
    }

    .list-group-flush .list-group-item {
        border-right: 0;
        border-left: 0;
        border-radius: 0;
    }

    /* Tables */
    .table {
        width: 100%;
        margin-bottom: 1rem;
        color: var(--text-light);
        border-collapse: collapse;
        background: rgba(42, 42, 42, 0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    .table td,
    .table th {
        padding: 1rem 0.75rem;
        vertical-align: top;
        border-top: 1px solid rgba(68, 68, 68, 0.3);
        transition: background-color 0.2s ease;
    }

    .table tr:hover {
        background-color: rgba(102, 119, 234, 0.05);
    }

    .table-sm td,
    .table-sm th {
        padding: 0.75rem 0.5rem;
    }

    /* Utilities */
    .d-flex {
        display: flex;
    }

    .d-block {
        display: block;
    }

    .d-none {
        display: none;
    }

    .justify-content-between {
        justify-content: space-between;
    }

    .justify-content-center {
        justify-content: center;
    }

    .align-items-center {
        align-items: center;
    }

    .align-items-start {
        align-items: flex-start;
    }

    .align-items-end {
        align-items: flex-end;
    }

    .flex-wrap {
        flex-wrap: wrap;
    }

    .flex-grow-1 {
        flex-grow: 1;
    }

    .text-center {
        text-align: center;
    }

    .text-end {
        text-align: right;
    }

    .text-muted {
        color: var(--text-muted-order) !important;
    }

    .text-success {
        color: var(--success) !important;
    }

    .text-danger {
        color: var(--danger) !important;
    }

    .text-primary {
        color: #666 !important;
    }

    .fw-medium {
        font-weight: 500;
    }

    .fw-bold {
        font-weight: 600;
    }

    .mb-0 {
        margin-bottom: 0;
    }

    .mb-2 {
        margin-bottom: 0.5rem;
    }

    .mb-3 {
        margin-bottom: 1rem;
    }

    .mb-4 {
        margin-bottom: 1.5rem;
    }

    .mb-md-0 {
        margin-bottom: 0;
    }

    .mt-3 {
        margin-top: 1rem;
    }

    .me-2 {
        margin-right: 0.5rem;
    }

    .ms-2 {
        margin-left: 0.5rem;
    }

    .my-4 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .py-3 {
        padding-top: 1rem;
        padding-bottom: 1rem;
    }

    .py-4 {
        padding-top: 1.5rem;
        padding-bottom: 1.5rem;
    }

    .py-5 {
        padding-top: 3rem;
        padding-bottom: 3rem;
    }

    .p-3 {
        padding: 1rem;
    }

    .gap-2 {
        gap: 0.5rem;
    }

    .g-3>* {
        padding: 0.5rem;
    }

    /* Badges */
    .badge {
        display: inline-block;
        padding: 0.35em 0.65em;
        /* font-size: 0.75em; */
        font-weight: 500;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.375rem;
    }

    /* Spinners */
    .spinner-border {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        vertical-align: text-bottom;
        border: 0.25em solid;
        border-color: rgba(102, 119, 234, 0.2);
        border-right-color: #667eea;
        border-radius: 50%;
        /* animation: spinner-border 0.75s linear infinite; */
    }

    .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.2em;
    }

    /* @keyframes spinner-border {
        to {
            transform: rotate(360deg);
        }
    } */

    .loading-spinner {
        width: 2rem;
        height: 2rem;
        border-width: 0.25em;
        border-color: rgba(102, 119, 234, 0.2);
        border-right-color: #667eea;
        margin: 2rem auto;
        /* animation: spin-pulse 1s linear infinite; */
    }

    /* @keyframes spin-pulse {
        0% {
            transform: rotate(0deg) scale(1);
            opacity: 1;
        }
        50% {
            transform: rotate(180deg) scale(1.1);
            opacity: 0.8;
        }
        100% {
            transform: rotate(360deg) scale(1);
            opacity: 1;
        }
    } */

    .visually-hidden {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
    }

    /* Position utilities */
    .position-fixed {
        position: fixed;
    }

    .top-0 {
        top: 0;
    }

    .start-50 {
        left: 50%;
    }

    .translate-middle-x {
        transform: translateX(-50%);
    }

    /* Shadow */
    .shadow-sm {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.3) !important;
    }

    /* Alert dismissible */
    .alert-dismissible {
        padding-right: 3rem;
    }

    .fade {
        opacity: 0;
        transition: opacity 0.15s linear;
    }

    .fade.show {
        opacity: 1;
    }

    /* Icon styles */
    .icon {
        font-size: 1rem;
        vertical-align: middle;
        display: inline-block;
        font-weight: bold;
    }

    .icon-large {
        font-size: 2.5rem;
        display: inline-block;
    }

    /* Page specific styles */
    .highlight {
        animation: highlight-fade 2s ease-out;
    }

    @keyframes highlight-fade {
        0% {
            background: linear-gradient(135deg, rgba(102, 119, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            transform: scale(1.02);
        }

        50% {
            background: linear-gradient(135deg, rgba(102, 119, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
        }

        100% {
            background: transparent;
            transform: scale(1);
        }
    }    /* Custom Order Status Filter Button Styles */
    .status-filter {
        margin: 2px;
        font-weight: 500;
        border-width: 2px !important;
        transition: all 0.3s ease;
        position: relative;
    }

    /* Active state general styles */
    .status-filter.active {
        font-weight: 700 !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
        transform: translateY(-1px) !important;
    }

    /* All Button - Blue */
    .status-filter[data-filter="all"] {
        color: #0d6efd !important;
        border-color: #0d6efd !important;
        background-color: transparent !important;
    }

    .status-filter[data-filter="all"]:hover {
        color: #0d6efd !important;
        border-color: #0d6efd !important;
        background-color: rgba(13, 110, 253, 0.1) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2) !important;
    }

    .status-filter[data-filter="all"].active {
        color: #0d6efd !important;
        border-color: #0d6efd !important;
        /* background-color: #0d6efd !important; */
        box-shadow: 0 3px 8px rgba(13, 110, 253, 0.3) !important;
    }

    /* Recent Button - Purple */
    .status-filter[data-filter="recent"] {
        color: #6f42c1 !important;
        border-color: #6f42c1 !important;
        background-color: transparent !important;
    }

    .status-filter[data-filter="recent"]:hover {
        color: #6f42c1 !important;
        border-color: #6f42c1 !important;
        background-color: rgba(111, 66, 193, 0.1) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 4px rgba(111, 66, 193, 0.2) !important;
    }

    .status-filter[data-filter="recent"].active {
        color: #ffffff !important;
        border-color: #6f42c1 !important;
        /* background-color: #6f42c1 !important; */
        box-shadow: 0 3px 8px rgba(111, 66, 193, 0.3) !important;
    }

    /* Completed Button - Green */
    .status-filter[data-filter="completed"] {
        color: #198754 !important;
        border-color: #198754 !important;
        background-color: transparent !important;
    }

    .status-filter[data-filter="completed"]:hover {
        color: #198754 !important;
        border-color: #198754 !important;
        background-color: rgba(25, 135, 84, 0.1) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 4px rgba(25, 135, 84, 0.2) !important;
    }

    .status-filter[data-filter="completed"].active {
        color: #ffffff !important;
        border-color: #198754 !important;
        /* background-color: #198754 !important; */
        box-shadow: 0 3px 8px rgba(25, 135, 84, 0.3) !important;
    }

    /* Ongoing Button - Orange */
    .status-filter[data-filter="ongoing"] {
        color: #fd7e14 !important;
        border-color: #fd7e14 !important;
        background-color: transparent !important;
    }

    .status-filter[data-filter="ongoing"]:hover {
        color: #fd7e14 !important;
        border-color: #fd7e14 !important;
        background-color: rgba(253, 126, 20, 0.1) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 4px rgba(253, 126, 20, 0.2) !important;
    }

    .status-filter[data-filter="ongoing"].active {
        color: #ffffff !important;
        border-color: #fd7e14 !important;
        /* background-color: #fd7e14 !important; */
        box-shadow: 0 3px 8px rgba(253, 126, 20, 0.3) !important;
    }

    /* Pending Payment Button - Red */
    .status-filter[data-filter="pending_payment"] {
        color: #dc3545 !important;
        border-color: #dc3545 !important;
        background-color: transparent !important;
    }

    .status-filter[data-filter="pending_payment"]:hover {
        color: #dc3545 !important;
        border-color: #dc3545 !important;
        background-color: rgba(220, 53, 69, 0.1) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.2) !important;
    }

    .status-filter[data-filter="pending_payment"].active {
        color: #ffffff !important;
        border-color: #dc3545 !important;
        /* background-color: #dc3545 !important; */
        box-shadow: 0 3px 8px rgba(220, 53, 69, 0.3) !important;
    }

    /* Focus states for accessibility */
    .status-filter:focus {
        box-shadow: 0 0 0 0.2rem rgba(var(--bs-btn-focus-shadow-rgb), 0.5) !important;
    }

    /* Remove Bootstrap default focus shadow and use custom */
    .status-filter:focus-visible {
        outline: none;
    }

    /* Your existing order status styles remain the same */
    .order-status {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .order-status-icon {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        position: relative;
        display: inline-block;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 currentColor;
        }

        70% {
            box-shadow: 0 0 0 8px rgba(0, 0, 0, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
        }
    }

    .status-pending {
        background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    }

    .status-completed {
        background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
    }

    .status-processing {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .status-failed {
        background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    }

    .loading-spinner {
        width: 1.5rem;
        height: 1.5rem;
        border-width: 0.2em;
    }

    /* Filter section styling */
    .filter-section {
        background: linear-gradient(145deg, rgba(42, 42, 42, 0.9) 0%, rgba(51, 51, 51, 0.9) 100%);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        box-shadow:
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(102, 119, 234, 0.2);
        color: var(--text-light);
        backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
    }

    .filter-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        opacity: 0.7;
    }

    .filter-section h5 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--text-light);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Order list styling */
    .order-list-container {
        max-height: 70vh;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(102, 119, 234, 0.5) transparent;
    }

    .order-list-container::-webkit-scrollbar {
        width: 6px;
    }

    .order-list-container::-webkit-scrollbar-track {
        background: rgba(68, 68, 68, 0.2);
        border-radius: 3px;
    }

    .order-list-container::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 3px;
    }

    .order-list-container::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    }

    .order-item {
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .order-item:hover {
        transform: translateX(4px);
    }

    .order-item .badge {
        font-size: 0.75em;
        padding: 0.4em 0.8em;
        border-radius: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* Order detail styling */
    .order-detail-section {
        padding: 2rem;
        background: linear-gradient(145deg, rgba(42, 42, 42, 0.5) 0%, rgba(51, 51, 51, 0.5) 100%);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        margin: 1rem;
    }

    .detail-header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(102, 119, 234, 0.2);
        position: relative;
    }

    .detail-header::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 50px;
        height: 2px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .detail-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: rgba(42, 42, 42, 0.3);
        border-radius: 8px;
        border: 1px solid rgba(68, 68, 68, 0.2);
    }

    .detail-section h6 {
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-light);
        font-size: 1.1rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Payment button styling */
    .payment-btn {
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 25px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.85rem;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
    }

    .payment-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s;
    }

    .payment-btn:hover::before {
        left: 100%;
    }

    .payment-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 119, 234, 0.4);
    }

   /* Header Bar */
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      margin-left: 0.5rem;
      margin-top: -1rem;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
      letter-spacing: 1px;
      color: #000000;
      position: relative;
      text-transform: uppercase;
      padding-bottom: 0.6rem;
      text-align: left;
      /* <-- Ensure left alignment */
    }


    .page-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      /* initial width */
      height: 4px;
      background-color: #000000;
      border-radius: 2px;
      transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
      /* added transition for both properties */
    }

    .page-title:hover::after {
      width: 110%;
      /* makes the underline grow */
      transform: translateX(-50%);
      /* keep it centered */
    }

</style>
{% endblock %}

{% block content %}

{% if messages %}
<div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1100;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
        <div class="d-flex align-items-center">
            {% if message.tags == 'success' %}
            <span class="icon me-2">✓</span>
            {% elif message.tags == 'warning' %}
            <span class="icon me-2">⚠</span>
            {% elif message.tags == 'error' %}
            <span class="icon me-2">✗</span>
            {% else %}
            <span class="icon me-2">ℹ</span>
            {% endif %}
            <div>{{ message }}</div>
        </div>
        <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">&times;</button>
    </div>
    {% endfor %}
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.display = 'none';
            });
        }, 5000);
    });
</script>
{% endif %}

<div class="container-fluid my-4">
    <div class="header-bar d-flex align-items-center justify-content-between flex-wrap mb-3">
        <h1 class="page-title mb-0 me-3">My Orders</h1>
        <div class="text-muted" style="color : rgb(0, 0, 0)  !important;" id="order-count-text">0 orders found</div>
    </div>

    <!-- Filters section -->
    <div class="filter-section mb-4 customer-card">
        <div class="row g-3">
            <!-- Status filters -->
            <div class="col-md-4">
                <label class="form-label" style="cursor: pointer !important;">Order Status</label>
                <div class="d-flex flex-wrap">
                    <button type="button" class="btn btn-sm status-filter active" data-filter="all">All</button>
                    <button type="button" class="btn btn-sm status-filter" data-filter="recent">Recent</button>
                    <button type="button" class="btn btn-sm status-filter" data-filter="completed">Completed</button>
                    <button type="button" class="btn btn-sm status-filter" data-filter="ongoing">Ongoing</button>
                    <button type="button" class="btn btn-sm status-filter" data-filter="pending_payment">Pending
                        Payment</button>
                </div>
            </div>

            <!-- Date filters -->
            <div class="col-md-4">
                <div class="row">
                    <div class="col-md-5">
                        <label for="date_from" class="form-label" style="cursor: pointer;">From Date</label>
                        <input type="date" class="form-control form-control-sm" style="cursor: pointer;" id="date_from">
                    </div>
                    <div class="col-md-5">
                        <label for="date_to" class="form-label">To Date</label>
                        <input type="date" class="form-control form-control-sm" style="cursor: pointer;" id="date_to">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="button" class="btn btn-sm btn-primary w-100"
                            style="width: max-content;margin-left: -7px;background: linear-gradient(135deg, #333, #555);color: #ffffff;" id="apply-date-filter">Apply</button>
                    </div>
                </div>
            </div>

            <!-- Sorting options -->
            <div class="col-md-2">
                <label for="sort" class="form-label">Sort By</label>
                <select class="form-select form-select-sm" style="cursor: pointer;" id="sort">
                    <option value="-order_date">Newest First</option>
                    <option value="order_date">Oldest First</option>
                    <option value="-overall_amount">Amount (High to Low)</option>
                    <option value="overall_amount">Amount (Low to High)</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="category-filter" class="form-label">Category</label>
                <select id="category-filter" class="form-select form-select-sm" style="cursor: pointer;">
                    <option value="all">All Categories</option>
                    <option value="1">Rice</option>
                    <option value="2">Paddy</option>
                    <option value="3">Pesticide</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Main content with two-panel layout -->
    <div class="row">
        <!-- Left panel: Order list -->
        <div class="col-md-4">
            <div class="dashboard-card order-list-container customer-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Order List</h5>
                    <div class=" spinner-border-sm text-primary d-none" id="loading-spinner" role="status">

                    </div>
                </div>
                {% csrf_token %}
                <div class="list-group list-group-flush" id="orders-list">
                    <div class="text-center py-4">

                    </div>
                </div>
            </div>
        </div>

        <!-- Right panel: Order details -->
        <div class="col-md-8">
            <div class="dashboard-card h-100 customer-card">
                <div class="card-header">
                    <h5>Order Details</h5>
                </div>
                <div class="order-detail-section" id="order-details">
                    <div class="text-center py-5">
                        <i class="bi bi-box-seam text-muted" style="font-size: 2.5rem;"></i>
                        <p class="mt-3">Select an order to view details</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Global variables
        let allOrders = [];
        let filteredOrders = [];
        let selectedOrderId = null;
        let currentFilter = 'all';
        let currentSort = '-order_date';
        let dateFrom = '';
        let dateTo = '';
        let currentCategory = 'all';

        // DOM Elements
        const ordersList = document.getElementById('orders-list');
        const orderDetails = document.getElementById('order-details');
        const orderCountText = document.getElementById('order-count-text');
        const statusFilters = document.querySelectorAll('.status-filter');
        const dateFromInput = document.getElementById('date_from');
        const dateToInput = document.getElementById('date_to');
        const applyDateBtn = document.getElementById('apply-date-filter');
        const sortSelect = document.getElementById('sort');
        const loadingSpinner = document.getElementById('loading-spinner');
        const categorySelect = document.getElementById('category-filter');

        // Set CSRF token for AJAX requests
        const csrfToken = getCookie('csrftoken');

        // Initialization
        fetchOrders();

        // Event Listeners
        statusFilters.forEach(btn => {
            btn.addEventListener('click', function () {
                // Update UI for selected filter
                statusFilters.forEach(b => {
                    b.classList.remove('btn-primary', 'btn-success', 'btn-warning', 'btn-danger');
                    b.classList.add('btn-outline-primary', 'btn-outline-success', 'btn-outline-warning', 'btn-outline-danger');
                });

                const filterType = this.dataset.filter;
                this.classList.remove(`btn-outline-${getButtonType(filterType)}`);
                this.classList.add(`btn-${getButtonType(filterType)}`);

                // Apply filter
                currentFilter = filterType;
                applyFilters();
            });
        });

        applyDateBtn.addEventListener('click', function () {
            dateFrom = dateFromInput.value;
            dateTo = dateToInput.value;
            applyFilters();
        });

        sortSelect.addEventListener('change', function () {
            currentSort = this.value;
            applyFilters();
        });

        categorySelect.addEventListener('change', function () {
            currentCategory = this.value;
            applyFilters();
        });

        // Helper function to get button type based on filter
        function getButtonType(filter) {
            switch (filter) {
                case 'completed': return 'success';
                case 'ongoing': return 'warning';
                case 'pending_payment': return 'danger';
                default: return 'primary';
            }
        }

        // Functions
        function fetchOrders() {
            showLoading(true);

            fetch(window.location.pathname, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                }
            })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    allOrders = data.orders;

                    // Convert string dates to Date objects for easier filtering
                    allOrders.forEach(order => {
                        order.orderDateObj = new Date(order.order_date);
                        if (order.delivery_date) {
                            order.deliveryDateObj = new Date(order.delivery_date);
                        }
                    });

                    // Apply initial filters
                    applyFilters();
                    showLoading(false);
                })
                .catch(error => {
                    console.error('Error fetching orders:', error);
                    ordersList.innerHTML = `
                    <div class="list-group-item">
                        <div class="text-center text-danger py-3">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            Error loading orders. Please try again.
                        </div>
                    </div>
                `;
                    showLoading(false);
                });
        }

        function applyFilters() {
            showLoading(true);

            // Start with all orders
            let result = [...allOrders];

            // Apply status filter
            switch (currentFilter) {
                case 'completed':
                    result = result.filter(order => order.delivery_status === 1);
                    break;
                case 'ongoing':
                    result = result.filter(order => order.delivery_status === 0);
                    break;
                case 'pending_payment':
                    result = result.filter(order => order.payment_status === 0);
                    break;
                case 'recent':
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                    result = result.filter(order => order.orderDateObj >= sevenDaysAgo);
                    break;
            }

            // Apply category filter
            if (currentCategory !== 'all') {
                const categoryId = parseInt(currentCategory);
                result = result.filter(order => order.product_category_id === categoryId);
            }

            // Apply date range filter
            if (dateFrom) {
                const fromDate = new Date(dateFrom);
                result = result.filter(order => order.orderDateObj >= fromDate);
            }

            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setHours(23, 59, 59, 999);
                result = result.filter(order => order.orderDateObj <= toDate);
            }

            // Apply sorting
            result = sortOrders(result, currentSort);

            // Update filteredOrders
            filteredOrders = result;

            // Update order count text
            updateOrderCountText();

            // Render the orders list
            renderOrdersList();

            // Update selected order if needed
            updateSelectedOrder();

            // Render order details
            renderOrderDetails();

            // Update URL for bookmarking
            updateURL();

            showLoading(false);
        }

        function sortOrders(orders, sortBy) {
            return orders.sort((a, b) => {
                const desc = sortBy.startsWith('-');
                const field = desc ? sortBy.substring(1) : sortBy;

                let valueA, valueB;

                if (field === 'order_date') {
                    valueA = a.orderDateObj;
                    valueB = b.orderDateObj;
                } else {
                    valueA = a[field];
                    valueB = b[field];
                }

                if (valueA < valueB) return desc ? 1 : -1;
                if (valueA > valueB) return desc ? -1 : 1;
                return 0;
            });
        }

        function updateOrderCountText() {
            const count = filteredOrders.length;
            orderCountText.textContent = `${count} ${count === 1 ? 'order' : 'orders'} found`;
        }

        function renderOrdersList() {
            if (filteredOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="list-group-item">
                        <div class="text-center py-3">
                            <i class="bi bi-search me-2"></i>
                            No orders match your filters
                        </div>
                    </div>
                `;
                return;
            }

            let html = '';
            filteredOrders.forEach(order => {
                const isActive = order.order_id === selectedOrderId;
                const statusClass = order.delivery_status === 1 ? 'status-completed' : 'status-pending';
                const paymentStatus = order.payment_status === 1 ? 'Paid' : 'Pending';
                const paymentStatusBadge = getPaymentStatusBadge(order.payment_status);

                html += `
                    <div class="list-group-item order-item ${isActive ? 'active' : ''}" 
                         data-order-id="${order.order_id}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="fw-medium">Order #${order.order_id}</span>
                                <span class="order-status ms-2">
                                    <span class="order-status-icon ${statusClass}"></span>
                                    <large>${paymentStatusBadge}</large>
                                </span>
                            </div>
                            <small class="text-muted">${formatDate(order.order_date)}</small>
                        </div>
                        <div class="d-flex justify-content-between">
                            <div>
                                <small class="text-muted">${getCategoryName(order.product_category_id)}</small>
                                <small class="d-block">${order.quantity} item(s)</small>
                            </div>
                            <div>
                                <small class="text-muted">${getCategoryName(order.category)}</small>
                                <small class="d-block">${order.quantity} item(s)</small>
                            </div>
                            <div class="text-end">
                                <div class="fw-medium">₹${order.overall_amount.toLocaleString()}</div>
                                <small class="text-muted">${order.delivery_status === 1 ? 'Delivered' : 'Processing'}</small>
                            </div>
                        </div>
                    </div>
                `;
            });

            ordersList.innerHTML = html;

            // Add click event listeners
            document.querySelectorAll('#orders-list .order-item').forEach(item => {
                item.addEventListener('click', function () {
                    const orderId = parseInt(this.dataset.orderId);

                    // Update selected order
                    document.querySelectorAll('#orders-list .order-item').forEach(el => {
                        el.classList.remove('active');
                    });
                    this.classList.add('active');

                    selectedOrderId = orderId;
                    renderOrderDetails();
                    updateURL();
                });
            });
        }

        function updateSelectedOrder() {
            if (!selectedOrderId || !filteredOrders.some(order => order.order_id === selectedOrderId)) {
                selectedOrderId = filteredOrders.length > 0 ? filteredOrders[0].order_id : null;
            }
        }

        function getPaymentStatusBadge(status) {
            switch(parseInt(status)) {
                case 0: return '<span style="color: red;" class="bg-danger">Unpaid</span>';
                case 1: return '<span style="color: orange;" class="orange-status text-dark">Partially Paid</span>';
                case 2: return '<span style="color: green;" class="bg-success">Fully Paid</span>';
                default: return '<span style="color: white;" class="bg-secondary">Unknown</span>';
            }
        }

        function renderOrderDetails() {
            if (!selectedOrderId) {
                orderDetails.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-box-seam text-muted" style="font-size: 2.5rem;"></i>
                        <p class="mt-3">Select an order to view details</p>
                    </div>
                `;
                return;
            }

            const order = filteredOrders.find(o => o.order_id === selectedOrderId);
            if (!order) {
                orderDetails.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-exclamation-triangle text-muted" style="font-size: 2.5rem;"></i>
                        <p class="mt-3">Order not found</p>
                    </div>
                `;
                return;
            }

            const statusClass = order.delivery_status === 1 ? 'status-completed' : 'status-pending';
            const paymentStatusClass = order.payment_status === 1 ? 'text-success' : 'text-danger';
            const paymentStatusBadge = getPaymentStatusBadge(order.payment_status);

            orderDetails.innerHTML = `
                <div class="detail-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="fw-bold">Order #${order.order_id}</h6>
                            <p class="text-muted mb-0">Placed on ${formatDate(order.order_date)}</p>
                        </div>
                        <div class="order-status">
                            <span class="order-status-icon ${statusClass}"></span>
                            <span class="fw-medium">${order.delivery_status === 1 ? 'Completed' : 'Processing'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <h6>Order Summary</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td class="text-muted">Category:</td>
                                    <td>${getCategoryName(order.product_category_id)}</td>
                                </tr>
                                ${order.product_category_id === 3 ? '' : `
                                <tr>
                                    <td class="text-muted">Quantity:</td>
                                    <td>${order.quantity}</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Price Per Unit:</td>
                                    <td>₹${order.price_per_unit.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                </tr>
                                `}
                                <tr>
                                    <td class="text-muted">Total Amount:</td>
                                    <td class="fw-medium">₹${order.overall_amount.toLocaleString()}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="col-md-6">
                            <h6>Payment Information</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td class="text-muted">Status:</td>
                                    <td><span class="${paymentStatusClass}">${paymentStatusBadge}</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Paid Amount:</td>
                                    <td>₹${order.paid_amount ? order.paid_amount.toLocaleString() : '0'}</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">GST:</td>
                                    <td>${order.GST || 'N/A'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h6>Delivery Information</h6>
                    <table class="table table-sm">
                        <tr>
                            <td class="text-muted">Status:</td>
                            <td>${order.delivery_status === 1 ? 'Delivered' : 'In Transit'}</td>
                        </tr>
                        ${order.delivery_date ? `
                        <tr>
                            <td class="text-muted">Delivery Date:</td>
                            <td>${formatDate(order.delivery_date)}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td class="text-muted">Lorry Number:</td>
                            <td>${order.lorry_number || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td class="text-muted">Driver Name:</td>
                            <td>${order.driver_name || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td class="text-muted">Driver Phone:</td>
                            <td>${order.driver_ph_no || 'N/A'}</td>
                        </tr>
                    </table>
                </div>
                
                <div class="d-flex gap-2">
                    ${order.paid_amount < order.overall_amount ? `
                        <form method="post" action="payment/" class="flex-grow-1">
                            <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                            <input type="hidden" name="order_id" value="${order.order_id}">    
                            <button class="btn btn-primary1 payment-btn w-100"  type="submit">
                                <i class="bi bi-credit-card-fill me-2"></i>Make Payment
                            </button>
                        </form>
                    ` : ''}
                    
                    ${order.delivery_status === 0 ? `
                        <form method="post" action="delivery/" class="flex-grow-1">
                            <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                            <input type="hidden" name="order_id" value="${order.order_id}">
                            <input type="hidden" name="delivery_status" value="1">
                            <button class="btn btn-success payment-btn w-100" type="submit">
                                <i class="bi bi-check-circle-fill me-2"></i>Mark as Delivered
                            </button>
                        </form>
                    ` : ''}
                </div>
            `;

            // Add highlight animation
            orderDetails.classList.add('highlight');
            setTimeout(() => {
                orderDetails.classList.remove('highlight');
            }, 1000);
        }

        // Helper Functions
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function getCategoryName(categoryId) {
            switch (categoryId) {
                case 1: return 'Rice';
                case 2: return 'Paddy';
                case 3: return 'Pesticide';
                default: return 'Other';
            }
        }

        function showLoading(isLoading) {
            loadingSpinner.classList.toggle('d-none', !isLoading);
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // URL handling for browser history and bookmarking
        function updateURL() {
            const url = new URL(window.location.href);
            url.searchParams.set('filter', currentFilter);

            if (dateFrom) url.searchParams.set('date_from', dateFrom);
            else url.searchParams.delete('date_from');

            if (dateTo) url.searchParams.set('date_to', dateTo);
            else url.searchParams.delete('date_to');

            url.searchParams.set('sort', currentSort);

            if (selectedOrderId) url.searchParams.set('order_id', selectedOrderId);
            else url.searchParams.delete('order_id');

            if (currentCategory !== 'all') url.searchParams.set('category', currentCategory);
            else url.searchParams.delete('category');

            window.history.replaceState({}, '', url);
        }

        // Initialize from URL parameters
        function initFromURL() {
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.has('filter')) currentFilter = urlParams.get('filter');
            if (urlParams.has('date_from')) dateFrom = urlParams.get('date_from');
            if (urlParams.has('date_to')) dateTo = urlParams.get('date_to');
            if (urlParams.has('sort')) currentSort = urlParams.get('sort');
            if (urlParams.has('order_id')) selectedOrderId = parseInt(urlParams.get('order_id'));
            if (urlParams.has('category')) currentCategory = urlParams.get('category');

            updateUI();
        }

        function updateUI() {
            // Update status filter buttons
            statusFilters.forEach(btn => {
                const filterType = btn.dataset.filter;
                const btnType = getButtonType(filterType);

                btn.classList.remove('btn-primary', 'btn-success', 'btn-warning', 'btn-danger'); btn.classList.add(`btn-outline-${btnType}`);

                if (filterType === currentFilter) {
                    btn.classList.remove(`btn-outline-${btnType}`);
                    btn.classList.add(`btn-${btnType}`);
                }
            });

            // Update form controls
            dateFromInput.value = dateFrom;
            dateToInput.value = dateTo;
            sortSelect.value = currentSort;
            categorySelect.value = currentCategory;
        }

        // Initialize from URL if parameters exist
        initFromURL();

        // Handle browser back/forward
        window.addEventListener('popstate', function () {
            initFromURL();
            applyFilters();
        });
    });
</script>
{% endblock %}