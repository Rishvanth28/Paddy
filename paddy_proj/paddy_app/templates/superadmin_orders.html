
{% extends 'superadmin_base.html' %}
{% load static %}
{% block content %}
{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
<style>
/* CSS Variables */
.superadmin-orders-page {
    --primary: #6366f1;
    --primary-hover: #4f46e5;
    --primary-light: #e0e7ff;
    --success: #10b981;
    --success-light: #d1fae5;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --danger: #ef4444;
    --danger-light: #fee2e2;
    --info: #3b82f6;
    --info-light: #dbeafe;
    --light: #f8fafc;
    --dark: #0f172a;
    --gray: #64748b;
    --gray-light: #f1f5f9;
    --border: #e2e8f0;
    --border-light: #f1f5f9;
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Base styles for superadmin orders page only */
.superadmin-orders-page {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    color: #0f172a;
    line-height: 1.6;
    font-weight: 400;
    min-height: 100vh;
    padding: 0;
    margin: 0;
}

.superadmin-orders-page *,
.superadmin-orders-page *::before,
.superadmin-orders-page *::after {
    box-sizing: border-box;
}

/* Container */
.superadmin-orders-page .container-fluid {
    width: 100%;
    max-width: 100%;
    padding: 1.5rem;
    margin: 0 auto;
    background: transparent;
}

/* Page body override */
.superadmin-orders-page body,
body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    color: var(--dark);
    line-height: 1.6;
    font-weight: 400;
    min-height: 100vh;
}

/* Page Header */
.superadmin-orders-page .page-header {
    background: linear-gradient(120deg, #000000 0%, #2a2a2a 100%);
    color: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--shadow-lg);
}

.superadmin-orders-page .page-header h2 {
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 0.5rem;
    letter-spacing: -0.025em;
}

.superadmin-orders-page .page-header .subtitle {
    opacity: 0.9;
    font-size: 1rem;
}

/* Filter Section */
.superadmin-orders-page .filter-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--border-radius);
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
    position: relative;
}

.superadmin-orders-page .filter-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
    border-radius: var(--border-radius) var(--border-radius) 0 0;
}

.superadmin-orders-page .filter-section h5 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--dark);
    letter-spacing: -0.025em;
}

/* Filter Grid Layout using CSS Grid */
.superadmin-orders-page .filter-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

@media (min-width: 768px) {
    .superadmin-orders-page .filter-grid {
        grid-template-columns: 1fr 2fr;
    }
}

@media (min-width: 992px) {
    .superadmin-orders-page .filter-grid {
        align-items: end;
    }
}

/* Date Range Grid */
.superadmin-orders-page .date-range-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.5rem;
}

@media (min-width: 576px) {
    .superadmin-orders-page .date-range-grid {
        grid-template-columns: 1fr 1fr 1fr;
    }
}


/* Button Group Layout using Flexbox */
.superadmin-orders-page .button-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}
/* Form Controls */
.superadmin-orders-page .form-label {
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--dark);
    display: block;
}

.superadmin-orders-page .form-control,
.superadmin-orders-page .form-select {
    display: block;
    width: 100%;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: var(--dark);
    background-color: #fff;
    background-image: none;
    border: 1px solid var(--border);
    border-radius: var(--border-radius-sm);
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.superadmin-orders-page .form-control:focus,
.superadmin-orders-page .form-select:focus {
    color: var(--dark);
    background-color: #fff;
    border-color: var(--primary);
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
}

.superadmin-orders-page .form-control-sm,
.superadmin-orders-page .form-select-sm {
    min-height: calc(1.5em + 0.5rem + 2px);
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    border-radius: var(--border-radius-sm);
}

/* Buttons */
.superadmin-orders-page .btn {
    display: inline-block;
    font-weight: 400;
    line-height: 1.5;
    color: var(--dark);
    text-align: center;
    text-decoration: none;
    vertical-align: middle;
    cursor: pointer;
    user-select: none;
    background-color: transparent;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    border-radius: var(--border-radius-sm);
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.superadmin-orders-page .btn:hover {
    color: var(--dark);
    text-decoration: none;
}

.superadmin-orders-page .btn:focus {
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.superadmin-orders-page .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    border-radius: var(--border-radius-sm);
}

/* Button variants */
.superadmin-orders-page .btn-primary {
    color: #fff;
    background-color: var(--primary);
    border-color: var(--primary);
}

.superadmin-orders-page .btn-primary:hover {
    color: #fff;
    background-color: var(--primary-hover);
    border-color: var(--primary-hover);
}

.superadmin-orders-page .btn-outline-primary {
    color: var(--primary);
    border-color: var(--primary);
}

.superadmin-orders-page .btn-outline-primary:hover {
    color: #fff;
    background-color: var(--primary);
    border-color: var(--primary);
}

.superadmin-orders-page .btn-success {
    color: #fff;
    background-color: var(--success);
    border-color: var(--success);
}

.superadmin-orders-page .btn-outline-success {
    color: var(--success);
    border-color: var(--success);
}

.superadmin-orders-page .btn-outline-success:hover {
    color: #fff;
    background-color: var(--success);
    border-color: var(--success);
}

.superadmin-orders-page .btn-warning {
    color: #000;
    background-color: var(--warning);
    border-color: var(--warning);
}

.superadmin-orders-page .btn-outline-warning {
    color: var(--warning);
    border-color: var(--warning);
}

.superadmin-orders-page .btn-outline-warning:hover {
    color: #000;
    background-color: var(--warning);
    border-color: var(--warning);
}

.superadmin-orders-page .btn-danger {
    color: #fff;
    background-color: var(--danger);
    border-color: var(--danger);
}

.superadmin-orders-page .btn-outline-danger {
    color: var(--danger);
    border-color: var(--danger);
}

.superadmin-orders-page .btn-outline-danger:hover {
    color: #fff;
    background-color: var(--danger);
    border-color: var(--danger);
}

/* Badges */
.superadmin-orders-page .badge {
    display: inline-block;
    padding: 0.35em 0.65em;
    font-size: 0.75em;
    font-weight: 700;
    line-height: 1;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 0.25rem;
}

.superadmin-orders-page .bg-primary {
    background-color: var(--primary) !important;
}

.superadmin-orders-page .bg-success {
    background-color: var(--success) !important;
}

.superadmin-orders-page .bg-warning {
    background-color: var(--warning) !important;
    color: #000 !important;
}

.superadmin-orders-page .bg-danger {
    background-color: var(--danger) !important;
}

.superadmin-orders-page .bg-secondary {
    background-color: #6c757d !important;
}

.superadmin-orders-page .text-dark {
    color: #000 !important;
}

/* Loading Spinner */
.superadmin-orders-page .spinner-border {
    display: inline-block;
    width: 2rem;
    height: 2rem;
    vertical-align: text-bottom;
    border: 0.25em solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner-border 0.75s linear infinite;
}

@keyframes spinner-border {
    to {
        transform: rotate(360deg);
    }
}

.superadmin-orders-page .text-primary {
    color: var(--primary) !important;
}

/* Utilities - replacing Bootstrap utilities with CSS */
.superadmin-orders-page .d-flex {
    display: flex !important;
}

.superadmin-orders-page .flex-between {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.superadmin-orders-page .header-flex {
    flex-direction: row;
    align-items: flex-start;
}
.superadmin-orders-page #order-count-text {
    font-weight: 600;
    margin:auto 0;
}
.superadmin-orders-page .flex-center {
    display: flex;
    align-items: center;
}

.superadmin-orders-page .flex-col {
    display: flex;
    flex-direction: column;
}

.superadmin-orders-page .flex-wrap {
    flex-wrap: wrap;
}

.superadmin-orders-page .hidden {
    display: none !important;
}

.superadmin-orders-page .block {
    display: block !important;
}

.superadmin-orders-page .w-full {
    width: 100%;
}

.superadmin-orders-page .h-full {
    height: 100%;
}

.superadmin-orders-page .align-items-center {
    align-items: center;
}

.superadmin-orders-page .justify-content-between {
    justify-content: space-between;
}

/* Spacing utilities */
.superadmin-orders-page .m-0 {
    margin: 0;
}

.superadmin-orders-page .mb-0 {
    margin-bottom: 0;
}

.superadmin-orders-page .mb-1 {
    margin-bottom: 0.25rem;
}

.superadmin-orders-page .mb-2 {
    margin-bottom: 0.5rem;
}

.superadmin-orders-page .mb-4 {
    margin-bottom: 1.5rem;
}

.superadmin-orders-page .mt-3 {
    margin-top: 1rem;
}

.superadmin-orders-page .mr-1,
.superadmin-orders-page .me-2 {
    margin-right: 0.5rem;
}

.superadmin-orders-page .mr-2 {
    margin-right: 0.5rem;
}

.superadmin-orders-page .ml-2 {
    margin-left: 0.5rem;
}

.superadmin-orders-page .my-4 {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
}

.superadmin-orders-page .p-3 {
    padding: 1rem;
}

.superadmin-orders-page .py-3 {
    padding-top: 1rem;
    padding-bottom: 1rem;
}

.superadmin-orders-page .py-4 {
    padding-top: 1.5rem;
    padding-bottom: 1.5rem;
}

/* Text utilities */
.superadmin-orders-page .text-center {
    text-align: center;
}

.superadmin-orders-page .text-right {
    text-align: right;
}

.superadmin-orders-page .text-left {
    text-align: left;
}

.superadmin-orders-page .text-white-50 {
    color: rgba(255, 255, 255, 0.5);
}

.superadmin-orders-page .text-muted {
    color: #64748b;
    font-weight: 400;
}

.superadmin-orders-page .text-danger {
    color: #ef4444;
}

.superadmin-orders-page .font-bold,
.superadmin-orders-page .fw-bold {
    font-weight: 700;
}

.superadmin-orders-page .font-medium,
.superadmin-orders-page .fw-medium {
    font-weight: 500;
}

.superadmin-orders-page .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Alert System */
.superadmin-orders-page .alert {
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: var(--border-radius-sm);
    position: relative;
    display: flex;
    align-items: center;
}

.superadmin-orders-page .alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
}

.superadmin-orders-page .alert-warning {
    color: #856404;
    background-color: #fff3cd;
    border-color: #ffeaa7;
}

.superadmin-orders-page .alert-error,
.superadmin-orders-page .alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.superadmin-orders-page .alert-info {
    color: #0c5460;
    background-color: #d1ecf1;
    border-color: #bee5eb;
}

.superadmin-orders-page .alert-dismissible {
    padding-right: 4rem;
}

.superadmin-orders-page .btn-close {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 2;
    padding: 0.625rem 0.625rem;
    background: transparent;
    border: 0;
    border-radius: 0.25rem;
    opacity: 0.5;
    cursor: pointer;
}

.superadmin-orders-page .btn-close:hover {
    opacity: 0.75;
}

.superadmin-orders-page .btn-close:before {
    content: "×";
    font-size: 1.5rem;
    font-weight: bold;
}

.superadmin-orders-page .fade {
    transition: opacity 0.15s linear;
}

.superadmin-orders-page .show {
    opacity: 1;
}

/* Positioning and Effects */
.superadmin-orders-page .shadow-sm {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.superadmin-orders-page .position-fixed {
    position: fixed !important;
}

.superadmin-orders-page .top-0 {
    top: 0 !important;
}

.superadmin-orders-page .start-50 {
    left: 50% !important;
}

.superadmin-orders-page .translate-middle-x {
    transform: translateX(-50%) !important;
}

.superadmin-orders-page .relative {
    position: relative;
}

.superadmin-orders-page .absolute {
    position: absolute;
}

/* Table System */
/* Table System */
.superadmin-orders-page .table {
    width: 100%;
    margin-bottom: 1rem;
    color: var(--dark);
    vertical-align: top;
    border-color: var(--border);
    /* border-collapse: collapse; */
    border-radius: var(--border-radius-sm);
    overflow: scroll;
    /* box-shadow: var(--shadow); */
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
}
.superadmin-orders-page .table > :not(caption) > * > * {
    padding: 0.5rem 0.5rem;
    background-color: var(--bs-table-bg);
    border-bottom-width: 1px;
    box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
}

.superadmin-orders-page .table-sm > :not(caption) > * > * {
    padding: 1rem;
    border-color: var(--border-light);
    font-size: 0.875rem;
}

.superadmin-orders-page .table > thead {
    vertical-align: bottom;
}

.superadmin-orders-page .table > thead > tr > th {
    background: linear-gradient(135deg, var(--gray-light) 0%, var(--border-light) 100%);
    font-weight: 600;
    color: var(--dark);
    letter-spacing: 0.025em;
    text-transform: uppercase;
    font-size: 0.75rem;
    border-bottom: 2px solid var(--border);
}

.superadmin-orders-page .table > tbody > tr:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(255, 255, 255, 0.9) 100%);
}

.superadmin-orders-page .table-striped > tbody > tr:nth-of-type(odd) > td,
.superadmin-orders-page .table-striped > tbody > tr:nth-of-type(odd) > th {
    background-color: rgba(0, 0, 0, 0.05);
}

.superadmin-orders-page .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

/* Classic List Group - Simple & Clean */
.superadmin-orders-page .list-group {
    display: flex;
    flex-direction: column;
    padding-left: 0;
    margin-bottom: 0;
    border-radius: var(--border-radius-sm);
}

.superadmin-orders-page .list-group-item {
    position: relative;
    display: block;
    padding: 1rem 1.25rem;
    background-color: #fff;
    border: 1px solid #e5e5e5;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
}

.superadmin-orders-page .list-group-item:first-child {
    border-top-left-radius: inherit;
    border-top-right-radius: inherit;
}

.superadmin-orders-page .list-group-item:last-child {
    border-bottom-right-radius: inherit;
    border-bottom-left-radius: inherit;
}

.superadmin-orders-page .list-group-item + .list-group-item {
    border-top-width: 0;
}

.superadmin-orders-page .list-group-item:hover {
    background-color: #f8f9fa;
    border-color: #333;
}

.superadmin-orders-page .list-group-item.active {
    z-index: 2;
    color: #fff;
    background-color: #000;
    border-color: #000;
}

/* Order Layout - Traditional Responsive Design */
.superadmin-orders-page .order-layout {
    display: block;
    margin: 0 -0.75rem;
}

/* Order Panels - Default Mobile Stacked */
.superadmin-orders-page .order-list-panel,
.superadmin-orders-page .order-details-panel {
    padding: 0 0.75rem;
    margin-bottom: 1.5rem;
    width: 100%;
}

/* Small Mobile (Portrait) */
@media (max-width: 575.98px) {
    .superadmin-orders-page .order-layout {
        margin: 0 -0.5rem;
    }
    
    .superadmin-orders-page .order-list-panel,
    .superadmin-orders-page .order-details-panel {
        padding: 0 0.5rem;
        margin-bottom: 1rem;
    }
}

/* Tablet (768px and up) - Still stacked but better spacing */
@media (min-width: 768px) {
    .superadmin-orders-page .order-layout {
        margin: 0 -1rem;
    }
    
    .superadmin-orders-page .order-list-panel,
    .superadmin-orders-page .order-details-panel {
        padding: 0 1rem;
        margin-bottom: 2rem;
    }
}

/* Desktop (992px and up) - Side by Side Layout */
@media (min-width: 992px) {
    .superadmin-orders-page .order-layout {
        display: table;
        width: 100%;
        table-layout: fixed;
        margin: 0;
    }
    
    .superadmin-orders-page .order-list-panel {
        display: table-cell;
        width: 35%;
        vertical-align: top;
        padding-right: 1rem;
        margin-bottom: 0;
    }
    
    .superadmin-orders-page .order-details-panel {
        display: table-cell;
        width: 65%;
        vertical-align: top;
        padding-left: 1rem;
        margin-bottom: 0;
    }
}

/* Large Desktop (1200px and up) - Optimized proportions */
@media (min-width: 1200px) {
    .superadmin-orders-page .order-list-panel {
        width: 32%;
        padding-right: 1.5rem;
    }
    
    .superadmin-orders-page .order-details-panel {
        width: 68%;
        padding-left: 1.5rem;
    }
}

/* Extra Large Desktop (1400px and up) - Maximum width and spacing */
@media (min-width: 1400px) {
    .superadmin-orders-page .order-list-panel {
        width: 30%;
        padding-right: 2rem;
    }
    
    .superadmin-orders-page .order-details-panel {
        width: 70%;
        padding-left: 2rem;
    }
}

/* Classic Dashboard Cards - Simple & Functional */
.superadmin-orders-page .dashboard-card {
    background: #fff;
    border-radius: var(--border-radius-sm);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    border: 1px solid #e5e5e5;
    height: 100%;
    display: flex;
    flex-direction: column;
}

/* Classic Order List Container - Perfect Height Management */
.superadmin-orders-page .order-list-container {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.superadmin-orders-page .order-list-container .list-group {
    flex: 1;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #666 #f1f1f1;
}

.superadmin-orders-page .order-list-container .list-group::-webkit-scrollbar {
    width: 6px;
}

.superadmin-orders-page .order-list-container .list-group::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.superadmin-orders-page .order-list-container .list-group::-webkit-scrollbar-thumb {
    background: #666;
    border-radius: 3px;
}

.superadmin-orders-page .order-list-container .list-group::-webkit-scrollbar-thumb:hover {
    background: #333;
}

/* Classic Order Details Container - Perfect Height Management */
.superadmin-orders-page .order-details-panel .dashboard-card {
    height: 100%;
}

.superadmin-orders-page .order-detail-section {
    padding: 1.5rem;
    background: transparent;
    flex: 1;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #666 #f1f1f1;
}

.superadmin-orders-page .order-detail-section::-webkit-scrollbar {
    width: 6px;
}

.superadmin-orders-page .order-detail-section::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.superadmin-orders-page .order-detail-section::-webkit-scrollbar-thumb {
    background: #666;
    border-radius: 3px;
}

.superadmin-orders-page .order-detail-section::-webkit-scrollbar-thumb:hover {
    background: #333;
}

/* Classic Card Header */
.superadmin-orders-page .card-header {
    background-color: #f8f9fa;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e5e5e5;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
}

.superadmin-orders-page .card-header h5 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
}

.superadmin-orders-page .subtitle {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.25rem;
    font-weight: 400;
}

/* Classic Order Item Styles - Simple & Clean */
.superadmin-orders-page .order-item {
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    padding: 1rem 1.25rem;
    min-height: auto;
    display: block;
}

.superadmin-orders-page .order-item:hover {
    background-color: #f8f9fa;
    border-color: #333;
}

.superadmin-orders-page .order-item.active {
    background-color: #000;
    color: white;
    border-color: #000;
}

.superadmin-orders-page .order-item .badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 500;
}

/* Perfect Height Management - Responsive for All Screens */

/* Mobile Responsive Adjustments */
@media (max-width: 575.98px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1rem;
    }
    
    .superadmin-orders-page .detail-section {
        padding: 0.75rem;
        margin-bottom: 1rem;
    }
    
   .superadmin-orders-page .card-header {
        padding: 0.75rem 1rem;
        flex-direction: column;
        align-items: flex-start;
    }
    .superadmin-orders-page .card-header h5 {
        font-size: 1rem;
    }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1.25rem;
    }
    
    .superadmin-orders-page .card-header {
        padding: 1rem 1.25rem;
    }
}

@media (min-width: 768px) and (max-width: 991.98px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1.5rem;
    }
}

/* Desktop Layout - Perfect Height Management */
@media (min-width: 992px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
        
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1.5rem;
    }
}

@media (min-width: 1200px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
    }
}

@media (min-width: 1400px) {
    .superadmin-orders-page .dashboard-card {
        height: auto;
        min-height: auto;
    }
}

/* Classic Order Detail Elements - Simple & Clean */
.superadmin-orders-page .detail-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e5e5e5;
}

.superadmin-orders-page .detail-section {
    margin-bottom: 1.5rem;
    padding: 1.25rem;
    background: #fff;
    border-radius: var(--border-radius-sm);
    border: 1px solid #e5e5e5;
    box-sizing: border-box;
    width: 100%;
    overflow: hidden;
}

.superadmin-orders-page .detail-section h6 {
    font-weight: 600;
    margin-bottom: 1rem;
    color: #333;
    font-size: 1rem;
    padding-left: 0.75rem;
    border-left: 3px solid #000;
    line-height: 1.4;
    word-wrap: break-word;
}

/* Classic Table Styles with Enhanced Responsiveness */
.superadmin-orders-page .detail-section .table {
    margin-bottom: 0;
    background: transparent;
    width: 100%;
    table-layout: fixed;
}

.superadmin-orders-page .detail-section .table td {
    padding: 0.6rem 0.5rem;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
}

.superadmin-orders-page .detail-section .table td:first-child {
    font-weight: 500;
    color: #666;
    width: 40%;
    min-width: 120px;
}

.superadmin-orders-page .detail-section .table td:last-child {
    color: #333;
    font-weight: 400;
    width: 60%;
}

/* Order Details Grid */
.superadmin-orders-page .order-details-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

@media (min-width: 768px) {
    .superadmin-orders-page .order-details-grid {
        grid-template-columns: 1fr 1fr;
    }
}

/* Delivery Info Grid */
.superadmin-orders-page .delivery-info-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    align-items: center;
    overflow: scroll;
}
@media (min-width: 768px) {
    .superadmin-orders-page .delivery-info-grid {
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }
}

/* Delivery info grid responsiveness within detail sections */
.superadmin-orders-page .detail-section .delivery-info-grid > div {
    background: transparent;
    border: none;
    padding: 0;
}

.superadmin-orders-page .detail-section .delivery-info-grid .table {
    margin-bottom: 0;
}

/* Enhanced mobile responsiveness for delivery info */
@media (max-width: 575.98px) {
    .superadmin-orders-page .delivery-info-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    .superadmin-orders-page .detail-section .delivery-info-grid .table td {
        padding: 0.4rem 0.25rem;
        font-size: 0.85rem;
    }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    .superadmin-orders-page .delivery-info-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

/* Utility Classes for Perfect Alignment */
.superadmin-orders-page .text-truncate-responsive {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

@media (max-width: 575.98px) {
    .superadmin-orders-page .text-truncate-responsive {
        white-space: normal;
        word-wrap: break-word;
    }
}

/* Items Table - Classic Style */
.superadmin-orders-page .items-table {
    margin-top: 1.5rem;
    border-radius: var(--border-radius-sm);
    overflow: hidden;
    border: 1px solid #e5e5e5;
}

.superadmin-orders-page .items-table th {
    font-weight: 600;
    background: #000;
    color: white;
    border: none;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.75rem;
    padding: 0.75rem 0.5rem;
}

.superadmin-orders-page .items-table td {
    background: #fff;
    border-color: #f0f0f0;
    padding: 0.6rem 0.5rem;
}

.superadmin-orders-page .items-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

/* Search Input */
.superadmin-orders-page .search-container {
    position: relative;
}

.superadmin-orders-page .search-container .bi-search {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    z-index: 1;
}

.superadmin-orders-page .search-input {
    padding-left: 3rem;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--border);
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
}

.superadmin-orders-page .search-input:focus {
    background: white;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* Classic Simple Styles - Clean & Functional */
.superadmin-orders-page .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #666;
}

.superadmin-orders-page .empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
    color: #999;
}

.superadmin-orders-page .empty-state p {
    font-size: 1rem;
    margin-bottom: 0;
    color: #666;
}

/* Simple Order Status Indicators */
.superadmin-orders-page .order-status {
    display: inline-flex;
    align-items: center;
}

.superadmin-orders-page .order-status-icon {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 0.5rem;
}

.superadmin-orders-page .status-completed {
    background-color: var(--success);
}

.superadmin-orders-page .status-pending {
    background-color: var(--warning);
}

/* Classic Badge Styles */
.superadmin-orders-page .badge {
    display: inline-block;
    padding: 0.25em 0.6em;
    font-size: 0.75em;
    font-weight: 500;
    line-height: 1;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 4px;
}

/* Simple Animation */
.superadmin-orders-page .highlight {
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}
@media (max-width: 768px) {
   .superadmin-orders-page .header-flex {
        flex-direction: column !important;
        
    }
}

/* Enhanced Responsive Layout for Flexbox */
@media (max-width: 422px) {
    .superadmin-orders-page .flex-between {
        flex-direction: column !important;
        align-items: flex-start;
    }
    .superadmin-orders-page .text-right{
        text-align: left !important;
    }
}
/* Extra Small Mobile (Portrait phones) */
@media (max-width: 575.98px) {
    .superadmin-orders-page .page-header {
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .superadmin-orders-page .page-header h2 {
        font-size: 1.25rem;
    }
    
    .superadmin-orders-page .flex-between {
        flex-direction: row;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .superadmin-orders-page .filter-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1rem;
    }
    
    .superadmin-orders-page .container-fluid {
        padding: 0.75rem;
    }
}

/* Small Mobile (Landscape phones) */
@media (min-width: 576px) and (max-width: 767.98px) {
    .superadmin-orders-page .page-header {
        padding: 1.25rem;
    }
    
    .superadmin-orders-page .page-header h2 {
        font-size: 1.5rem;
    }
    
    .superadmin-orders-page .flex-between {
        flex-direction: row;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .superadmin-orders-page .filter-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1.25rem;
    }
}

/* Tablet (768px to 991px) */
@media (min-width: 768px) and (max-width: 991.98px) {
    .superadmin-orders-page .page-header {
        padding: 1.5rem;
    }
    
    .superadmin-orders-page .page-header h2 {
        font-size: 1.75rem;
    }
    
    .superadmin-orders-page .flex-between {
        flex-direction: row;
        align-items: center;
    }
    
    .superadmin-orders-page .filter-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }
    
    .superadmin-orders-page .order-detail-section {
        padding: 1.5rem;
    }
    
    .superadmin-orders-page .date-range-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
    
    .superadmin-orders-page .button-group {
        justify-content: flex-start;
    }
    
    .superadmin-orders-page .order-details-grid {
        grid-template-columns: 1fr;
    }
    
    .superadmin-orders-page .delivery-info-grid {
        grid-template-columns: 1fr;
    }
}

/* Additional Responsive Utilities */
@media (max-width: 575.98px) {
    .superadmin-orders-page .date-range-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .superadmin-orders-page .detail-section {
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .superadmin-orders-page .detail-section h6 {
        font-size: 0.95rem;
        padding-left: 0.5rem;
    }
    
    .superadmin-orders-page .detail-section .table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.9rem;
    }
    
    .superadmin-orders-page .detail-section .table td:first-child {
        width: 45%;
        min-width: 100px;
    }
    
    .superadmin-orders-page .detail-section .table td:last-child {
        width: 55%;
    }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    .superadmin-orders-page .date-range-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
    
    .superadmin-orders-page .detail-section {
        padding: 1.1rem;
        margin-bottom: 1.25rem;
    }
    
    .superadmin-orders-page .detail-section h6 {
        font-size: 1rem;
        padding-left: 0.65rem;
    }
    
    .superadmin-orders-page .detail-section .table td {
        padding: 0.55rem 0.4rem;
        font-size: 0.95rem;
    }
    
    .superadmin-orders-page .detail-section .table td:first-child {
        width: 42%;
        min-width: 110px;
    }
    
    .superadmin-orders-page .detail-section .table td:last-child {
        width: 58%;
    }
}

@media (min-width: 768px) {
    .superadmin-orders-page .order-details-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .superadmin-orders-page .delivery-info-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .superadmin-orders-page .detail-section {
        padding: 1.25rem;
        margin-bottom: 1.5rem;
    }
    
    .superadmin-orders-page .detail-section h6 {
        font-size: 1.05rem;
        padding-left: 0.75rem;
    }
    
    .superadmin-orders-page .detail-section .table td {
        padding: 0.6rem 0.5rem;
        font-size: 1rem;
    }
    
    .superadmin-orders-page .detail-section .table td:first-child {
        width:77%;
        min-width: 120px;
    }
    
    .superadmin-orders-page .detail-section .table td:last-child {
        width: 60%;
    }
    
}

/* Large screen adjustments */
@media (min-width: 1200px) {
    .superadmin-orders-page .container-fluid {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .superadmin-orders-page .detail-section {
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .superadmin-orders-page .detail-section h6 {
        font-size: 1.1rem;
        margin-bottom: 1.25rem;
        padding-left: 1rem;
    }
    
    .superadmin-orders-page .detail-section .table td {
        padding: 0.75rem 0.5rem;
        font-size: 1rem;
    }
    
    .superadmin-orders-page .detail-section .table td:first-child {
        width: 55%;
        min-width: 140px;
    }
    
    .superadmin-orders-page .detail-section .table td:last-child {
        width: 65%;
    }
}

/* Ultra-wide screen adjustments */
@media (min-width: 1600px) {
    .superadmin-orders-page .container-fluid {
        max-width: 1600px;
    }
    
    .superadmin-orders-page .detail-section {
        padding: 1.75rem;
        margin-bottom: 2.25rem;
    }
    
    .superadmin-orders-page .detail-section h6 {
        font-size: 1.15rem;
        margin-bottom: 1.5rem;
        padding-left: 1.25rem;
    }
    
    .superadmin-orders-page .detail-section .table td {
        padding: 0.85rem 0.75rem;
        font-size: 1.05rem;
    }
}

/* Items Table Responsiveness within Detail Sections */
.superadmin-orders-page .detail-section .table-responsive {
    border-radius: var(--border-radius-sm);
    box-shadow: none;
    border: 1px solid #e5e5e5;
    margin-top: 0.5rem;
}

.superadmin-orders-page .detail-section .items-table {
    margin-top: 0;
    border-radius: 0;
    overflow: scroll;
    box-shadow: none;
    border: none;
}

.superadmin-orders-page .detail-section .items-table th {
    font-weight: 600;
    background: #000;
    color: white;
    border: none;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.75rem;
    padding: 0.75rem 0.5rem;
}

.superadmin-orders-page .detail-section .items-table td {
    background: #fff;
    border-color: #f0f0f0;
    padding: 0.6rem 0.5rem;
    font-size: 0.9rem;
}

.superadmin-orders-page .detail-section .items-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.superadmin-orders-page .detail-section .items-table tfoot tr {
    background: #f1f3f4;
    font-weight: 600;
}

/* Mobile responsiveness for items table */
@media (max-width: 767.98px) {
    .superadmin-orders-page .detail-section .items-table th,
    .superadmin-orders-page .detail-section .items-table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.8rem;
    }
    
    .superadmin-orders-page .detail-section .items-table th {
        font-size: 0.7rem;
    }
}
</style>




{% endblock %}



{% if messages %}
<div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1100;">
{% for message in messages %}
<div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
<div class="flex-center">
{% if message.tags == 'success' %}
<i class="bi bi-check-circle-fill mr-2"></i>
{% elif message.tags == 'warning' %}
<i class="bi bi-exclamation-triangle-fill mr-2"></i>
{% elif message.tags == 'error' %}
<i class="bi bi-x-circle-fill mr-2"></i>
{% else %}
<i class="bi bi-info-circle-fill mr-2"></i>
{% endif %}
<div>{{ message }}</div>
</div>
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
setTimeout(function() {
document.querySelectorAll('.alert').forEach(alert => {
alert.style.opacity = '0';
setTimeout(() => alert.remove(), 300);
});
}, 5000);
});
</script>
{% endif %}

<div class="superadmin-orders-page">
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="page-header">
        <div class="flex-between header-flex">
            <div>
                <h2 class="mb-0">{% if request.session.role == 'superadmin' %}All Customer Orders{% else %}Customer Orders{% endif %}</h2>
                <p class="subtitle mb-0">Manage and track order status, payments, and deliveries</p>
            </div>
            <div class="text-white-50" id="order-count-text">
                <i class="bi bi-box-seam mr-2"></i>0 orders found
            </div>
        </div>
    </div>
    <!-- Filters section -->
    <div class="filter-section">
        <h5><i class="bi bi-funnel mr-2"></i>Filter Orders</h5>
        <div class="filter-grid">
            <!-- Status filters -->
            <div>
                <label class="form-label"><i class="bi bi-check-circle mr-1"></i>Order Status</label>
                <div class="button-group">
                    <button type="button" class="btn btn-sm btn-primary status-filter" data-filter="all">All</button>
                    <button type="button" class="btn btn-sm btn-outline-primary status-filter" data-filter="recent">Recent</button>
                    <button type="button" class="btn btn-sm btn-outline-success status-filter" data-filter="completed">Completed</button>
                    <button type="button" class="btn btn-sm btn-outline-warning status-filter" data-filter="ongoing">Processing</button>
                    <button type="button" class="btn btn-sm btn-outline-danger status-filter" data-filter="pending_payment">Pending Payment</button>
                </div>
            </div>
            <!-- Date filters -->
            <div>
                <label class="form-label"><i class="bi bi-calendar-range mr-1"></i>Date Range</label>
                <div class="date-range-grid">
                    <input type="date" class="form-control form-control-sm" id="date_from" placeholder="From" style="min-width:0;">
                    <input type="date" class="form-control form-control-sm" id="date_to" placeholder="To" style="min-width:0;">
                    <button type="button" class="btn btn-sm btn-primary w-full" id="apply-date-filter"
                        style="margin-bottom: 8px; border-radius: 50px; background: linear-gradient(135deg, #000000, #333333); color: white; letter-spacing: 0.5px; font-weight: 600; box-shadow: var(--shadow-md); padding: 0.625rem 2rem; border: none; position: relative; overflow: hidden; z-index: 1; transition: all 0.3s ease; min-width:0;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-lg)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-md)';">
                        Apply
                    </button>
                </div>
            </div>
           
            {% if request.session.role == 'superadmin' %}
            <div>
                <label for="admin-filter" class="form-label"><i class="bi bi-person-badge mr-1"></i>Filter by Admin</label>
                <select id="admin-filter" class="form-select form-select-sm">
                    <option value="all">All Admins</option>
                </select>
            </div>
            {% endif %}
        
            <!-- Category filter -->
            <div>
                <label for="category-filter" class="form-label"><i class="bi bi-tag mr-1"></i>Category</label>
                <select id="category-filter" class="form-select form-select-sm">
                    <option value="all">All Categories</option>
                    <option value="1">Rice</option>
                    <option value="2">Paddy</option>
                    <option value="3">Pesticide</option>
                </select>
            </div>
            <!-- Sorting options -->
            <div>
                <label for="sort" class="form-label"><i class="bi bi-sort-down mr-1"></i>Sort By</label>
                <select class="form-select form-select-sm" id="sort">
                    <option value="-order_id">Newest First</option>
                    <option value="order_id">Oldest First</option>
                    <option value="-overall_amount">Amount (High to Low)</option>
                    <option value="overall_amount">Amount (Low to High)</option>
                </select>
            </div>
            <!-- Search box -->
            <div>
                <label class="form-label"><i class="bi bi-search mr-1"></i>Search Orders</label>
                <div class="search-container">
                    <i class="bi bi-search"></i>
                    <input type="text" class="form-control search-input" id="search-input" placeholder="Search by order ID, customer name or customer ID...">
                </div>
            </div>
        </div>
    </div>
    <!-- Main content with two-panel layout -->
    <div class="order-layout">
        <!-- Left panel: Order list -->
        <div class="order-list-panel">
            <div class="dashboard-card order-list-container">
            <div class="card-header">
                <h5><i class="bi bi-list-ul mr-2"></i>Order List</h5>
                <div class="spinner-border text-primary hidden" id="loading-spinner" role="status">
                <span class="sr-only">Loading...</span>
                </div>
            </div>
            {% csrf_token %}
            <div class="list-group" id="orders-list">
                <div class="empty-state">
                <div class="spinner-border text-primary loading-spinner" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Right panel: Order details -->
        <div class="order-details-panel">
            <div class="dashboard-card">
            <div class="card-header">
                    <h5><i class="bi bi-receipt mr-2"></i>Order Details</h5>
                    <div class="subtitle">View comprehensive order information</div>
                </div>
                <div class="order-detail-section" id="order-details">
                    <div class="empty-state">
                    <i class="bi bi-box-seam"></i>
                    <p>Select an order to view details</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Global variables
        let allOrders = [];
        let filteredOrders = [];
        let selectedOrderId = null;
        let currentFilter = 'all';
        let currentSort = '-order_id';
        let dateFrom = '';
        let dateTo = '';
        let currentCategory = 'all';
        let searchQuery = '';
        let currentAdmin = 'all'; // For superadmin filtering
        let isSuperadmin = {% if request.session.role == 'superadmin' %}true{% else %}false{% endif %};
        
        // DOM Elements
        const ordersList = document.getElementById('orders-list');
        const orderDetails = document.getElementById('order-details');
        const orderCountText = document.getElementById('order-count-text');
        const statusFilters = document.querySelectorAll('.status-filter');
        const dateFromInput = document.getElementById('date_from');
        const dateToInput = document.getElementById('date_to');
        const applyDateBtn = document.getElementById('apply-date-filter');
        const sortSelect = document.getElementById('sort');
        const categorySelect = document.getElementById('category-filter');
        const searchInput = document.getElementById('search-input');
        const loadingSpinner = document.getElementById('loading-spinner');
        const adminSelect = isSuperadmin ? document.getElementById('admin-filter') : null;
        
        // Set CSRF token for AJAX requests
        const csrfToken = getCookie('csrftoken');
        
        // Initialization
        if (isSuperadmin) {
            fetchAdmins();
        }
        fetchOrders();
        
        // Event Listeners
        statusFilters.forEach(btn => {
            btn.addEventListener('click', function() {
                // Update UI for selected filter
                statusFilters.forEach(b => {
                    const filterType = b.dataset.filter;
                    const btnType = getButtonType(filterType);
                    b.classList.remove(`btn-${btnType}`);
                    b.classList.add(`btn-outline-${btnType}`);
                });
                
                const filterType = this.dataset.filter;
                const btnType = getButtonType(filterType);
                this.classList.remove(`btn-outline-${btnType}`);
                this.classList.add(`btn-${btnType}`);
                
                // Apply filter
                currentFilter = filterType;
                applyFilters();
            });
        });
        
        applyDateBtn.addEventListener('click', function() {
            dateFrom = dateFromInput.value;
            dateTo = dateToInput.value;
            applyFilters();
        });
        
        sortSelect.addEventListener('change', function() {
            currentSort = this.value;
            applyFilters();
        });
        
        categorySelect.addEventListener('change', function() {
            currentCategory = this.value;
            applyFilters();
        });
        
        if (isSuperadmin && adminSelect) {
            adminSelect.addEventListener('change', function() {
                currentAdmin = this.value;
                applyFilters();
            });
        }
        
        // Debounce search input
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchQuery = this.value.trim();
                applyFilters();
            }, 500);
        });
        
        // Helper function to get button type based on filter
        function getButtonType(filter) {
            switch(filter) {
                case 'completed': return 'success';
                case 'ongoing': return 'warning';
                case 'pending_payment': return 'danger';
                default: return 'primary';
            }
        }
        
        // Functions
        function fetchAdmins() {
            if (!isSuperadmin) return;
            
            fetch('/api/get-admins/', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Error:', data.error);
                    return;
                }
                
                let html = '<option value="all">All Admins</option>';
                data.admins.forEach(admin => {
                    html += `<option value="${admin.admin_id}">${admin.first_name} ${admin.last_name}</option>`;
                });
                adminSelect.innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching admins:', error);
            });
        }
        
        function fetchOrders() {
            showLoading(true);
            
            // Build URL with query parameters
            const url = new URL(window.location.pathname, window.location.origin);
            if (currentFilter !== 'all') url.searchParams.append('status', currentFilter);
            if (dateFrom) url.searchParams.append('date_from', dateFrom);
            if (dateTo) url.searchParams.append('date_to', dateTo);
            if (currentCategory !== 'all') url.searchParams.append('category', currentCategory);
            if (searchQuery) url.searchParams.append('search', searchQuery);
            url.searchParams.append('sort', currentSort);
            
            // Add admin filter for superadmin
            if (isSuperadmin && currentAdmin !== 'all') {
                url.searchParams.append('admin_id', currentAdmin);
            }
            
            fetch(url, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                allOrders = data.orders;
                
                // Convert string dates to Date objects for easier handling
                allOrders.forEach(order => {
                    order.orderDateObj = new Date(order.order_date);
                    if (order.delivery_date) {
                        order.deliveryDateObj = new Date(order.delivery_date);
                    }
                });
                
                // Set filtered orders to all orders initially
                filteredOrders = [...allOrders];
                
                // Update order count text
                updateOrderCountText();
                
                // Render the orders list
                renderOrdersList();
                
                // Update selected order if needed
                updateSelectedOrder();
                
                // Render order details
                renderOrderDetails();
                
                showLoading(false);
            })
            .catch(error => {
                console.error('Error fetching orders:', error);
                ordersList.innerHTML = `
                    <div class="list-group-item">
                        <div class="text-center text-danger py-3">
                            <i class="bi bi-exclamation-triangle-fill mr-2"></i>
                            Error loading orders: ${error.message}
                        </div>
                    </div>
                `;
                showLoading(false);
            });
        }
        
        function applyFilters() {
            showLoading(true);
            fetchOrders();
            updateURL();
        }
          function updateOrderCountText() {
            const count = filteredOrders.length;
            const icon = '<i class="bi bi-box-seam mr-2"></i>';
            orderCountText.innerHTML = `${icon}${count} ${count === 1 ? 'order' : 'orders'} found`;
        }
          function renderOrdersList() {
            if (filteredOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="list-group-item">
                        <div class="empty-state">
                            <i class="bi bi-search"></i>
                            <p>No orders match your filters</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredOrders.forEach(order => {
                const isActive = order.order_id === selectedOrderId;
                const statusClass = order.delivery_status === 1 ? 'status-completed' : 'status-pending';
                const paymentStatusBadge = getPaymentStatusBadge(order.payment_status);
                const deliveryStatusBadge = getDeliveryStatusBadge(order.delivery_status);
                
                html += `
                    <div class="list-group-item order-item ${isActive ? 'active' : ''}" 
                         data-order-id="${order.order_id}">
                        <div class="flex-between mb-2">
                            <div>
                                <span class="font-medium">Order #${order.order_id}</span>
                                <span class="order-status ml-2">
                                    <span class="order-status-icon ${statusClass}"></span>
                                    <small>${paymentStatusBadge}</small>
                                </span>
                            </div>
                            <small class="text-muted">${formatDate(order.order_date)}</small>
                        </div>
                        <div class="flex-between mb-1">
                            <div>
                                <small class="text-muted">${getCategoryName(order.product_category_id)}</small>
                                <small class="block">${order.customer_full_name}</small>
                                ${isSuperadmin && order.admin_name ? `<small class="block text-muted">Admin: ${order.admin_name}</small>` : ''}
                            </div>
                            <div class="text-right">
                                <div class="font-medium">₹${order.overall_amount.toLocaleString()}</div>
                                <small>${deliveryStatusBadge}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            ordersList.innerHTML = html;
            
            // Add click event listeners
            document.querySelectorAll('#orders-list .order-item').forEach(item => {
                item.addEventListener('click', function() {
                    const orderId = parseInt(this.dataset.orderId);
                    
                    // Update selected order
                    document.querySelectorAll('#orders-list .order-item').forEach(el => {
                        el.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    selectedOrderId = orderId;
                    renderOrderDetails();
                    updateURL();
                });
            });
        }
        
        function updateSelectedOrder() {
            if (!selectedOrderId || !filteredOrders.some(order => order.order_id === selectedOrderId)) {
                selectedOrderId = filteredOrders.length > 0 ? filteredOrders[0].order_id : null;
            }
        }
          function renderOrderDetails() {
            if (!selectedOrderId) {
                orderDetails.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-box-seam"></i>
                        <p>Select an order to view details</p>
                    </div>
                `;
                return;
            }
            
            const order = filteredOrders.find(o => o.order_id === selectedOrderId);
            if (!order) {
                orderDetails.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-exclamation-triangle"></i>
                        <p>Order not found</p>
                    </div>
                `;
                return;
            }
            
            const paymentStatusBadge = getPaymentStatusBadge(order.payment_status);
            const deliveryStatusBadge = getDeliveryStatusBadge(order.delivery_status);
            
            // For superadmin, show admin information
            let adminInfoHtml = '';
            if (isSuperadmin && order.admin_id) {
                adminInfoHtml = `
                    <div class="detail-section">
                        <h6>Admin Information</h6>
                        <table class="table table-sm">
                            <tr>
                                <td class="text-muted">Admin ID:</td>
                                <td>${order.admin_id}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Admin Name:</td>
                                <td>${order.admin_name || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Admin Email:</td>
                                <td>${order.admin_email || 'N/A'}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }
            
            // Order items section
            let orderItemsHtml = '';
            if (order.product_category_id === 3) { // Multiple items (pesticides)
                orderItemsHtml = `
                    <div class="detail-section">
                        <h6>Order Items</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-striped items-table">                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Category</th>
                                        <th>Batch #</th>
                                        <th>Expiry</th>
                                        <th>Quantity</th>
                                        <th>Price/Unit</th>
                                        <th>Unit</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${order.order_items.map(item => `
                                        <tr>
                                            <td>${item.product_name}</td>
                                            <td>${item.category || 'N/A'}</td>
                                            <td>${item.batch_number}</td>
                                            <td>${item.expiry_date !== 'N/A' ? formatDate(item.expiry_date) : 'N/A'}</td>
                                            <td>${item.quantity}</td>
                                            <td>₹${item.price_per_unit.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                                            <td>${item.unit}</td>
                                            <td>₹${item.total_amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                                <tfoot>
                                    <tr class="font-bold">
                                        <td colspan="6" class="text-right">Total:</td>
                                        <td>₹${order.overall_amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                // For single item orders (rice or paddy)
                const productName = order.product_category_id === 1 ? 'Rice' : 'Paddy';
                orderItemsHtml = `
                    <div class="detail-section">
                        <h6>Order Items</h6>
                        <table class="table table-sm">
                            <tr>
                                <td class="text-muted">Product Type:</td>
                                <td>${productName}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Category:</td>
                                <td>${order.category || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Quantity:</td>
                                <td>${order.quantity || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Price Per Unit:</td>
                                <td>₹${order.price_per_unit ? order.price_per_unit.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) : 'N/A'}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Total Amount:</td>
                                <td class="font-bold">₹${order.overall_amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }
            
            orderDetails.innerHTML = `
                <div class="detail-header">
                    <div class="detail-header-div flex-between">
                        <div>
                            <h5 class="font-bold">Order #${order.order_id}</h5>
                            <p class="text-muted mb-0">Placed on ${formatDate(order.order_date)}</p>
                        </div>
                        <div>
                            ${paymentStatusBadge} ${deliveryStatusBadge}
                        </div>
                    </div>
                </div>
                
                ${adminInfoHtml}
                
                <div class="order-details-grid">
                    <div class="detail-section">
                        <h6>Customer Information</h6>
                        <table class="table table-sm">
                            <tr>
                                <td class="text-muted">Customer ID:</td>
                                <td>${order.customer_id}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Customer Name:</td>
                                <td>${order.customer_full_name}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Phone:</td>
                                <td>${order.customer_phone || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">GST:</td>
                                <td>${order.GST || 'N/A'}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="detail-section">
                        <h6>Payment Information</h6>
                        <table class="table table-sm">
                            <tr>
                                <td class="text-muted">Total Amount:</td>
                                <td>₹${order.overall_amount.toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Paid Amount:</td>
                                <td>₹${order.paid_amount.toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Balance:</td>
                                <td>₹${(order.overall_amount - order.paid_amount).toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Payment Terms:</td>
                                <td>${order.payment_deadline || 0} days</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Status:</td>
                                <td>${paymentStatusBadge}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                ${orderItemsHtml}
                
                <div class="detail-section">
                    <h6>Delivery Information</h6>
                    <div class="delivery-info-grid">
                        <div>
                            <table class="table table-sm">
                                <tr>
                                    <td class="text-muted">Delivery Date:</td>
                                    <td>${formatDate(order.delivery_date) || 'Not scheduled'}</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Status:</td>
                                    <td>${deliveryStatusBadge}</td>
                                </tr>
                            </table>
                        </div>
                        <div>
                            <table class="table table-sm">
                                <tr>
                                    <td class="text-muted">Vehicle Number:</td>
                                    <td>${order.lorry_number || 'N/A'}</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Driver:</td>
                                    <td>${order.driver_name || 'N/A'}</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Driver Phone:</td>
                                    <td>${order.driver_ph_no || 'N/A'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
               
            `;
            
            // Add highlight animation
            orderDetails.classList.add('highlight');
            setTimeout(() => {
                orderDetails.classList.remove('highlight');
            }, 1000);
        }
        
        // Helper Functions
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
        
        function getCategoryName(categoryId) {
            switch(parseInt(categoryId)) {
                case 1: return 'Rice';
                case 2: return 'Paddy';
                case 3: return 'Pesticide';
                default: return 'Other';
            }
        }
        
        function getPaymentStatusBadge(status) {
            switch(parseInt(status)) {
                case 0: return '<span class="badge bg-danger">Unpaid</span>';
                case 1: return '<span class="badge bg-warning text-dark">Partially Paid</span>';
                case 2: return '<span class="badge bg-success">Fully Paid</span>';
                default: return '<span class="badge bg-secondary">Unknown</span>';
            }
        }
        
        function getDeliveryStatusBadge(status) {
            return status === 1 
                ? '<span class="badge bg-success">Delivered</span>' 
                : '<span class="badge bg-warning text-dark">Processing</span>';
        }
        
        function showLoading(isLoading) {
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
            } else {
                loadingSpinner.classList.add('hidden');
            }
        }
        
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // URL handling for browser history and bookmarking
        function updateURL() {
            const url = new URL(window.location.href);
            
            if (currentFilter !== 'all') url.searchParams.set('status', currentFilter);
            else url.searchParams.delete('status');
            
            if (dateFrom) url.searchParams.set('date_from', dateFrom);
            else url.searchParams.delete('date_from');
            
            if (dateTo) url.searchParams.set('date_to', dateTo);
            else url.searchParams.delete('date_to');
            
            url.searchParams.set('sort', currentSort);
            
            if (selectedOrderId) url.searchParams.set('order_id', selectedOrderId);
            else url.searchParams.delete('order_id');
            
            if (currentCategory !== 'all') url.searchParams.set('category', currentCategory);
            else url.searchParams.delete('category');
            
            if (searchQuery) url.searchParams.set('search', searchQuery);
            else url.searchParams.delete('search');
            
            if (isSuperadmin && currentAdmin !== 'all') {
                url.searchParams.set('admin_id', currentAdmin);
            } else {
                url.searchParams.delete('admin_id');
            }
            
            window.history.replaceState({}, '', url);
        }
        
        // Order status update functions (these would need backend endpoints)
        window.updateOrderDeliveryStatus = function(orderId, status) {
            if (confirm(`Are you sure you want to ${status === 1 ? 'mark this order as delivered' : 'change this order back to processing'}?`)) {
                fetch('/api/update-order-delivery-status/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        delivery_status: status
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }
                    
                    // Show success message
                    alert('Order status updated successfully!');
                    
                    // Refresh orders to show updated status
                    fetchOrders();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the order status.');
                });
            }
        };
        
        window.recordPayment = function(orderId) {
            // Implementation would depend on your system's payment recording functionality
            alert('Payment recording functionality to be implemented');
        };
        
        window.viewPaymentHistory = function(orderId) {
            // Implementation would depend on your system's payment history tracking
            alert('Payment history functionality to be implemented');
        };
        
        window.sendPaymentReminder = function(orderId) {
            // Implementation would depend on your system's notification functionality
            alert('Payment reminder functionality to be implemented');
        };
        
        // Initialize from URL parameters
        function initFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('status')) {
                currentFilter = urlParams.get('status');
                
                // Update status filter buttons
                statusFilters.forEach(btn => {
                    const filterType = btn.dataset.filter;
                    const btnType = getButtonType(filterType);
                    
                    btn.classList.remove('btn-primary', 'btn-success', 'btn-warning', 'btn-danger');
                    btn.classList.add(`btn-outline-${btnType}`);
                    
                    if (filterType === currentFilter) {
                        btn.classList.remove(`btn-outline-${btnType}`);
                        btn.classList.add(`btn-${btnType}`);
                    }
                });
            }
            
            if (urlParams.has('date_from')) {
                dateFrom = urlParams.get('date_from');
                dateFromInput.value = dateFrom;
            }
            
            if (urlParams.has('date_to')) {
                dateTo = urlParams.get('date_to');
                dateToInput.value = dateTo;
            }
            
            if (urlParams.has('sort')) {
                currentSort = urlParams.get('sort');
                sortSelect.value = currentSort;
            }
            
            if (urlParams.has('order_id')) {
                selectedOrderId = parseInt(urlParams.get('order_id'));
            }
            
            if (urlParams.has('category')) {
                currentCategory = urlParams.get('category');
                categorySelect.value = currentCategory;
            }
            
            if (urlParams.has('search')) {
                searchQuery = urlParams.get('search');
                searchInput.value = searchQuery;
            }
            
            if (isSuperadmin && urlParams.has('admin_id')) {
                currentAdmin = urlParams.get('admin_id');
                // We'll set the adminSelect value after it's loaded
            }
        }
        
        // Initialize from URL if parameters exist
        initFromURL();
        
        // Handle browser back/forward
        window.addEventListener('popstate', function() {
            initFromURL();
            fetchOrders();
        });
    });
</script>
{% endblock %}
{% endblock %}
